<!DOCTYPE html>
<html lang="cn">







<head>
  <title>How Project Leyden brought a new perspective - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/leyden-1/" />
  <meta property="og:title" content="How Project Leyden brought a new perspective" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/leyden-1/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/leyden-1/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/leyden-1/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/leyden-1/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/leyden-1/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/leyden-1/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/blog/leyden-1/">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUS是什么？</a></li>
          <li><a href="/developer-joy" class="">开发者的乐趣 </a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES 原生</a></li>
          <li><a href="/standards" class="">标准</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">容器优先 </a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入门</a></li>
          <li><a href="/guides" class="" >指南</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP视频</a></li>          
          <li><a href="/books" class="">书籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">浏览扩展</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">使用扩展</a></li>
          <li><a href="/guides/writing-extensions" class="" >创建扩展</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">支持</a></li>
          <li><a href="/blog" class="active" >博客</a></li>
          <li><a href="/discussion" class="">讨论</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="" >播客</a></li>
          <li><a href="/events" class="">活动</a></li>
          <li><a href="/newsletter" class="">新闻</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">路线图</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">开始编码</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/leyden-1/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/leyden-1/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/leyden-1/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/leyden-1/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/leyden-1/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> How Project Leyden brought a new perspective</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          February 24, 2026 
          
            <span class="tags"><a href="/blog/tag/performance">#performance</a><a href="/blog/tag/development">#development</a><a href="/blog/tag/leyden">#leyden</a></span>
          
        </div>
        <h1 class="post-title">How Project Leyden brought a new perspective</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            <p class="byline">
              By 
              
              

              
              
              
                
                
                
                  <img class="headshot" src="https://www.gravatar.com/avatar/ec96387a1a8295b6fd6dffb68f80c352">
                
                  <a href="/author/gsmet">Guillaume Smet</a>
                  
              
            </p>
          </div>
          <div class="width-12-12">
              <div class="paragraph">
<p>This is a story about Project Leyden.
And this is not a story about Project Leyden.</p>
</div>
<div class="paragraph">
<p>It is a story about how Project Leyden gave us a new perspective on how we think about startup performance in Quarkus, and, more broadly, in Java.</p>
</div>
<div class="paragraph">
<p>It is a story with flamegraphs.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Isn&#8217;t it the best kind of story?</p>
</div>
</blockquote>
</div>
<div class="sect1">
<h2 id="acknowledgments"><a class="anchor" href="#acknowledgments"></a>Acknowledgments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I shared this journey with my dear colleague Georgios Andrianakis, who was also instrumental in making this happen.
And this is exactly the kind of journey you want to share with someone.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-the-story-started"><a class="anchor" href="#how-the-story-started"></a>How the story started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It all started with me complaining, more than once, that improving startup performance in Quarkus had become really hard.
Startup was cluttered with class loading noise.
Which means that every time you looked at a startup profile, you clicked on something suspicious and realized:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Oh well, that&#8217;s just us loading a class for the first time&#8230;&#8203; bummer.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>I&#8217;m a patient person.
But you only get so many mouse clicks per day.</p>
</div>
<div class="paragraph">
<p>Then, one day, I took a shower, and I had this idea:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Isn&#8217;t Project Leyden supposed to improve the class loading story, among other things?</p>
</div>
<div class="paragraph">
<p>Maybe we could use it to get rid of the class loading noise and get a clearer picture of what&#8217;s really going on during startup?</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>As it turns out, this was a bit of a rabbit hole.
Project Leyden delivered results that were far better than expected, and we ended up working with Georgios on integrating it tightly in Quarkus
(you can see another blog post coming, right?).</p>
</div>
<div class="paragraph">
<p>But today, I promised you flamegraphs. I know you&#8217;re all excited about them.
Let&#8217;s get to it!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changing-the-perspective"><a class="anchor" href="#changing-the-perspective"></a>Changing the perspective</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ll explore this in more detail in a future blog post, but for now, suffice it to say that Project Leyden caches classes in a loaded and linked state, along with additional metadata such as method profiling information and, soon, compiled code.</p>
</div>
<div class="paragraph">
<p>In practice, Project Leyden improves Java startup performance by shifting expensive work, like class loading and linking, into a dedicated training phase.
By capturing that state ahead of time, the application can skip much of the redundant setup normally performed at runtime.</p>
</div>
<div class="paragraph">
<p>In other words, if everything is recorded properly, class loading can be almost entirely taken out of the startup path.</p>
</div>
<div class="paragraph">
<p>And suddenly, you&#8217;re in brand-new territory: the Quarkus REST application you get from a simple <code>quarkus create app</code> starts in 130 milliseconds.</p>
</div>
<div class="paragraph">
<p>That&#8217;s already pretty good, right? But what&#8217;s even more interesting is that we were able to do much better (see you in the next blog post, remember?).</p>
</div>
<div class="paragraph">
<p>And this is where the perspective shifts significantly: when you start in ~ 100 milliseconds, every dozen milliseconds you save becomes a meaningful improvement.
You can no longer afford to ignore a 5-millisecond cost.</p>
</div>
<div class="paragraph">
<p>I can hear someone in the room shouting:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Stop with the words! I want my flamegraphs!</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Fine, fine.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-can-we-improve-as-an-ecosystem"><a class="anchor" href="#how-can-we-improve-as-an-ecosystem"></a>How can we improve as an ecosystem?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One extremely important note before we begin: <strong>we&#8217;re not trying to criticize any library or framework here</strong>.
We also found some low-hanging fruits in Quarkus itself, <strong>we&#8217;re all in the same boat here</strong>.</p>
</div>
<div class="paragraph">
<p>The goal of this blog post is to show how Project Leyden helped us uncover things that had been hidden for far too long.
And hopefully, this will give other library and framework authors a few useful ideas, and ultimately help improve the Java ecosystem as a whole.</p>
</div>
<div class="paragraph">
<p>And in the worst case, at least you got your flamegraphs \o/.</p>
</div>
<div class="sect2">
<h3 id="compatibility-layers"><a class="anchor" href="#compatibility-layers"></a>Compatibility layers</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-compatibility-layer.png" alt="Netty trying to determine whether virtual threads are available">
</div>
<div class="title">Figure 1. Netty trying to determine whether virtual threads are available</div>
</div>
<div class="paragraph">
<p>Many libraries include compatibility layers to support multiple JDK versions.
Typically, they rely on reflection to determine whether features like virtual threads are available.</p>
</div>
<div class="paragraph">
<p>In the Quarkus ecosystem, this is common in low-level libraries such as Netty or Vert.x.
But in reality, we see this pattern everywhere.</p>
</div>
<div class="paragraph">
<p>We should avoid this. It has a cost, and that cost is paid at <strong>every single</strong> startup of every application using these libraries.</p>
</div>
<div class="paragraph">
<p>Multi-release JARs are not perfect.
They&#8217;re harder to maintain, harder to test, and not always well supported by IDEs.
But they do solve this problem.
And I would argue that, as library and framework authors, it&#8217;s our responsibility to ensure the cost is paid once at build time, not at every application startup.</p>
</div>
<div class="paragraph">
<p>Together with Georgios, we decided to experiment with rewriting the bytecode of some of these libraries at build time to remove the reflective calls and replace them with direct invocations,
when the application was targeting a Java version that supports the feature.</p>
</div>
<div class="paragraph">
<p>It&#8217;s a bit of a hack, and definitely not something we want to maintain long term, but it was a great way to validate the idea and score a few quick wins.</p>
</div>
</div>
<div class="sect2">
<h3 id="reading-annotations"><a class="anchor" href="#reading-annotations"></a>Reading annotations</h3>
<div class="paragraph">
<p>This one isn&#8217;t new to us: one of the reasons we wrote Quarkus in the first place was to avoid reading annotations at runtime.</p>
</div>
<div class="paragraph">
<p>For most of our use cases, we can process annotations at build time and generate the necessary bytecode so there&#8217;s no need to inspect them at runtime.
Jandex, our annotation indexer, is a fantastic tool for this, and we use it extensively in Quarkus.
But&#8230;&#8203; there are still cases where annotations are read at runtime, even in Quarkus.</p>
</div>
<div class="paragraph">
<p>Why is reading annotations so costly?
Because parsing them has a cost. It happens the first time you try to access them at runtime, and the JDK then creates proxy instances to expose the annotation values.</p>
</div>
<div class="sect3">
<h4 id="netty-and-marker-annotations"><a class="anchor" href="#netty-and-marker-annotations"></a>Netty and marker annotations</h4>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-marker-annotation.png" alt="Netty trying to determine if a ChannelHandler is sharable">
</div>
<div class="title">Figure 2. Netty trying to determine if a <code>ChannelHandler</code> is sharable</div>
</div>
<div class="paragraph">
<p>The Netty case is particularly interesting because it reads annotations to determine the capabilities of interface implementations.</p>
</div>
<div class="paragraph">
<p>For this kind of use case, we recommend using marker interfaces or methods instead of annotations.</p>
</div>
<div class="paragraph">
<p>Georgios once again resorted to bytecode rewriting to eliminate the annotation lookup.
Again, this isn&#8217;t something we want to maintain in the long term.</p>
</div>
</div>
<div class="sect3">
<h4 id="hibernate-orm"><a class="anchor" href="#hibernate-orm"></a>Hibernate ORM</h4>
<div class="paragraph">
<p>Hibernate ORM is also extremely interesting in this context.</p>
</div>
<div class="paragraph">
<p>The first important point is that, with Hibernate ORM, in Quarkus, we still build the metadata at runtime.
That means we end up reading a lot of annotations at runtime.
A long-term effort has already started to improve this situation,
but it&#8217;s a significant undertaking and will take time before we can move metadata building to build time instead.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s set that aside for now.</p>
</div>
<div class="paragraph">
<p>What&#8217;s also interesting is that Hibernate ORM collects metadata about its own annotations at runtime, both Hibernate-specific annotations and JPA annotations.
And that&#8217;s a lot of annotations, and a lot of metadata to process.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-hibernate-annotations.png" alt="Hibernate ORM collecting metadata about its own annotations">
</div>
<div class="title">Figure 3. Hibernate ORM collecting metadata about its own annotations</div>
</div>
<div class="paragraph">
<p>For example, for each JPA or Hibernate annotation, it determines the annotation target (class, method, field), or whether it is inherited.</p>
</div>
<div class="paragraph">
<p>In the end, this results in a substantial amount of annotation processing for something that changes very rarely.</p>
</div>
<div class="paragraph">
<p>I identified this issue some time ago, and our colleague Luca Molteni from the Hibernate team will be looking into it soon.
We&#8217;re not yet sure how easy it will be to fix, but you get the idea.
Whenever possible, this kind of metadata should be resolved once and for all.
And you should be able to enforce its correctness with tests to ensure it remains accurate and up to date.</p>
</div>
<div class="paragraph">
<p>Hopefully, we&#8217;ll be able to improve this soon.
And the nice part is that any improvement here will benefit all applications using Hibernate ORM, not just Quarkus applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-new-cost-of-loading"><a class="anchor" href="#the-new-cost-of-loading"></a>The new cost of loading</h3>
<div class="paragraph">
<p>When not using Leyden, you load a gazillion classes.
JAR files are opened anyway, that&#8217;s <em>"fine"</em>.
Well, depending on your definition of <em>"fine"</em>.</p>
</div>
<div class="paragraph">
<p>When using Leyden, you can reach a point where no classes are loaded at startup at all.</p>
</div>
<div class="paragraph">
<p>Which means that anything attempting to load something from the classpath will trigger JAR files to be opened (the first time they are accessed), and then read from disk.</p>
</div>
<div class="paragraph">
<p>And you can be sure that some resources will be loaded from your classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServiceLoader</code> service files (the ones in <code>META-INF/services/</code>), used by the JDK and many libraries and frameworks to discover interface implementations;</p>
</li>
<li>
<p>Configuration files;</p>
</li>
<li>
<p>And probably many other things.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="non-existing-classes-and-resources"><a class="anchor" href="#non-existing-classes-and-resources"></a>Non-existing classes and resources</h4>
<div class="paragraph">
<p>Why would you try to load a non-existing class?
That&#8217;s a good question.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-packageinfo.png" alt="Hibernate ORM trying to load non-existing package-info">
</div>
<div class="title">Figure 4. Hibernate ORM trying to load non-existing <code>package-info</code></div>
</div>
<div class="paragraph">
<p>Remember <code>package-info.java</code> files?
Hibernate ORM, for instance, tries to load them to inspect package-level annotations.
In a lot of cases, these files don&#8217;t exist, and that&#8217;s perfectly normal.</p>
</div>
<div class="paragraph">
<p>Caching class loading is within the scope of Leyden, but Leyden does not cache negative lookups.
Why? Because Leyden, while AOT, is still true Java.
Java is a dynamic language:
even if a class wasn&#8217;t present when you recorded the cache, it might be added later.
Now, in practice, that&#8217;s often not the case, especially in Quarkus, where we assume a closed world, but Leyden cannot rely on that assumption.</p>
</div>
<div class="paragraph">
<p>In Quarkus, when using Leyden, we decided to generate empty <code>package-info</code> classes for all packages containing entities that don&#8217;t already have one.
This way, Hibernate ORM doesn&#8217;t have to attempt to load non-existing classes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-non-existing-class.png" alt="JBoss Logging loading a non-existing class">
</div>
<div class="title">Figure 5. JBoss Logging loading a non-existing class</div>
</div>
<div class="paragraph">
<p>Another example is JBoss Logging internationalization: it attempts to load a class for the current locale, and if that class doesn&#8217;t exist, it falls back to the default class.</p>
</div>
<div class="paragraph">
<p>You see similar patterns with resources.
An application might try to load a configuration file or a service descriptor that doesn&#8217;t exist. That&#8217;s perfectly normal, the only way to know it&#8217;s missing is to try.</p>
</div>
<div class="paragraph">
<p>In Quarkus, we have a few class loader tricks to mitigate this.
But in the general case, you have to deal with it.</p>
</div>
<div class="paragraph">
<p>And here&#8217;s the catch: for all these cases, the runtime will walk the entire classpath (remember, it won&#8217;t find anything), trying to locate the class or resource.
In doing so, it may open a large number of JAR files and read from them, just to conclude that the class or resource doesn&#8217;t exist.</p>
</div>
<div class="paragraph">
<p>Granted, it doesn&#8217;t read the entire JAR, each archive has an index, but still.</p>
</div>
</div>
<div class="sect3">
<h4 id="serviceloader"><a class="anchor" href="#serviceloader"></a>ServiceLoader</h4>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-serviceloader-storm.png" alt="A ServiceLoader storm">
</div>
<div class="title">Figure 6. A <code>ServiceLoader</code> storm</div>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the <code>ServiceLoader</code> case in more detail, it&#8217;s particularly interesting.</p>
</div>
<div class="paragraph">
<p>Once class loading is out of the picture, it becomes clear that a significant portion of startup time is spent loading service descriptors from JAR files.
We managed to improve this for some services using a class loader trick, but that only works for services loaded through the thread context class loader.
We don&#8217;t yet have a good solution for services loaded by the JDK class loaders.
At least not for now.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll go into more detail in the next blog post, where we&#8217;ll talk more about Project Leyden itself and how we integrated it into Quarkus.
Stay tuned.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="some-other-fun-facts"><a class="anchor" href="#some-other-fun-facts"></a>Some other <em>fun</em> facts</h3>
<div class="sect3">
<h4 id="uuid-generation"><a class="anchor" href="#uuid-generation"></a>UUID generation</h4>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-uuid.png" alt="Generating a UUID for the first time">
</div>
<div class="title">Figure 7. Generating a UUID for the first time</div>
</div>
<div class="paragraph">
<p>This one is easy: whenever you generate a <code>UUID</code>, the JDK will initialize a <code>SecureRandom</code> instance.
And initializing a <code>SecureRandom</code> instance doesn&#8217;t come for free, oh no.</p>
</div>
<div class="paragraph">
<p>Sure, if your application ends up needing a <code>SecureRandom</code> anyway, you don&#8217;t care.
But if it doesn&#8217;t, having your favorite framework generate <code>UUID</code>s for internal use is not ideal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Obviously, if your application genuinely needs <code>UUID</code> generation, go ahead and use it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="bigdecimal"><a class="anchor" href="#bigdecimal"></a>BigDecimal</h4>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-bigdecimal.png" alt="Initialization of BigDecimal">
</div>
<div class="title">Figure 8. Initialization of <code>BigDecimal</code></div>
</div>
<div class="paragraph">
<p>In the same vein, the <code>BigDecimal</code> class has a static initializer that actually performs a fair amount of work.
Initializing <code>BigDecimal</code> can take a noticeable amount of time.</p>
</div>
<div class="paragraph">
<p>We stumbled upon this because we were using <code>BigDecimal</code> to perform some calculations when printing the Quarkus startup time.</p>
</div>
<div class="paragraph">
<p>D&#8217;oh.</p>
</div>
<div class="paragraph">
<p>We replaced that code, only to discover another issue:
<code>BigDecimal</code> was also being eagerly initialized in Hibernate ORM for a very narrow use case in the <code>DurationJavaType</code> class.
That has since been fixed as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just like with <code>UUID</code>s, if your application genuinely needs <code>BigDecimal</code>, you should use it and pay the cost.</p>
</div>
<div class="paragraph">
<p>This is about avoiding the cost when you don&#8217;t actually need it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="time-zones"><a class="anchor" href="#time-zones"></a>Time zones</h4>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-timezone.png" alt="Loading the time zone database">
</div>
<div class="title">Figure 9. Loading the time zone database</div>
</div>
<div class="paragraph">
<p>We all know time zones are hard.
But now we also know that loading them is slow.</p>
</div>
<div class="paragraph">
<p>The time zone database is quite large, and loading it, for example when calling <code>TimeZone.getDefault()</code>, can take a noticeable amount of time.</p>
</div>
<div class="paragraph">
<p>Who would need a time zone in a server application, right?
For instance, your logging layer, which wants to print timestamps in the local time zone.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/leyden-1/flamegraph-zoneid.png" alt="Loading the zone rules">
</div>
<div class="title">Figure 10. Loading the zone rules</div>
</div>
<div class="paragraph">
<p>And what&#8217;s also interesting is that there&#8217;s an additional cost for transforming the time zone to a <code>ZoneId</code>, as you also have to load the zone rules.</p>
</div>
<div class="paragraph">
<p>These two issues still exist and I have no idea if we can even solve them,
but we were able to mitigate their cost somewhat in Quarkus when using the specific packaging we developed for AOT.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>解决方案</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This post is about the work we did in Quarkus and the libraries Quarkus relies on.
But I would argue that the lessons we learned are applicable across the entire Java ecosystem.</p>
</div>
<div class="paragraph">
<p>I hope that by sharing our experience, we can inspire other projects, especially library and framework authors, to take a similar approach and improve their startup performance.</p>
</div>
<div class="paragraph">
<p>And to be honest, this isn&#8217;t just about improving startup performance, it&#8217;s also about reducing the resources wasted during startup.
We often talk about Green IT; let&#8217;s make our libraries and frameworks greener, especially in cases where it&#8217;s simple to achieve.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve shared some of our findings and recipes, but I&#8217;m sure there are others that are specific to each library and framework.
Now is a great time to look at your own startup profiles and see if you can spot some low-hanging fruit to boost performance.
And with Quarkus 3.32 and our new AOT integration coming soon, this is going to be easier than ever.</p>
</div>
<div class="paragraph">
<p>If you have questions, you know <a href="https://quarkusio.zulipchat.com/#narrow/channel/187038-dev">where to find us</a>, and if you find something interesting, please share it with us, we&#8217;d love to hear about it!</p>
</div>
<div class="paragraph">
<p>Onwards!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="come-join-us"><a class="anchor" href="#come-join-us"></a>Come Join Us</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We value your feedback a lot so please report bugs, ask for improvements&#8230;&#8203; Let&#8217;s build something great together!</p>
</div>
<div class="paragraph">
<p>If you are a Quarkus user or just curious, don&#8217;t be shy and join our welcoming community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide feedback on <a href="https://github.com/quarkusio/quarkus/issues">GitHub</a>;</p>
</li>
<li>
<p>craft some code and <a href="https://github.com/quarkusio/quarkus/pulls">push a PR</a>;</p>
</li>
<li>
<p>discuss with us on <a href="https://quarkusio.zulipchat.com/">Zulip</a> and on the <a href="https://groups.google.com/d/forum/quarkus-dev">mailing list</a>;</p>
</li>
<li>
<p>ask your questions on <a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a>.</p>
</li>
</ul>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/leyden-1/&title=How Project Leyden brought a new perspective" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=How Project Leyden brought a new perspective&url=https://quarkus.io/blog/leyden-1/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/leyden-1/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/leyden-1/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=How Project Leyden brought a new perspective&amp;body=How Project Leyden brought a new perspective https://quarkus.io/blog/leyden-1/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">博客</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">活动</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">新闻</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">路线图</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">开始体验</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
