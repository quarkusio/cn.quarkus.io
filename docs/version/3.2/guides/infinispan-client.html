<!DOCTYPE html>
<html lang="cn">







<head>
  <title>Using the Infinispan Client - 3.2 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/3.2/guides/infinispan-client" />
  <meta property="og:title" content="Using the Infinispan Client - 3.2" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/infinispan-client">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/3.2/guides/infinispan-client" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/3.2/guides/infinispan-client" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/3.2/guides/infinispan-client" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/3.2/guides/infinispan-client" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/3.2/guides/infinispan-client" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/3.2/guides/infinispan-client">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUS是什么？</a></li>
          <li><a href="/developer-joy" class="">开发者的乐趣 </a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES 原生</a></li>
          <li><a href="/standards" class="">标准</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">容器优先 </a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入门</a></li>
          <li><a href="/guides" class="active" >指南</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP视频</a></li>          
          <li><a href="/books" class="">书籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">浏览扩展</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">使用扩展</a></li>
          <li><a href="/guides/writing-extensions" class="" >创建扩展</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">支持</a></li>
          <li><a href="/blog" class="" >博客</a></li>
          <li><a href="/discussion" class="">讨论</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="" >播客</a></li>
          <li><a href="/events" class="">活动</a></li>
          <li><a href="/newsletter" class="">新闻</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">路线图</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">开始编码</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/3.2/guides/infinispan-client" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/3.2/guides/infinispan-client">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/3.2/guides/infinispan-client">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/3.2/guides/infinispan-client">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/3.2/guides/infinispan-client">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    





<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/3.2/guides/">返回指南目录</a>
    </div>
    <div class="flexlabel">
      <label>选择指南版本</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.32.1 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      <h1 class="text-caps">Using the Infinispan Client </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide demonstrates how your Quarkus application can connect to an Infinispan server using the Infinispan Client extension.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>先决条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>完成这个指南，你需要:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>大概15分钟</p>
</li>
<li>
<p>编辑器</p>
</li>
<li>
<p>安装JDK 11以上版本并正确配置了 <code>JAVA_HOME</code></p>
</li>
<li>
<p>Apache Maven 3.9.3</p>
</li>
<li>
<p>如果你愿意的话，还可以选择使用<a href="cli-tooling">Quarkus CLI</a></p>
</li>
<li>
<p>如果你想构建原生可执行程序，可以选择安装Mandrel或者GraalVM，并<a href="building-native-image#configuring-graalvm">正确配置</a>(或者使用Docker在容器中进行构建)</p>
</li>
<li>
<p>A working Docker environment</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>架构</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we are going to expose a Greeting Rest API to create and display greeting messages by using
the <a href="https://infinispan.org/docs/stable/titles/hotrod_java/hotrod_java.html#remotecache_api">Infinispan RemoteCache API</a>
and <code>getAsync</code> and <code>putAsync</code> operations.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll be using the Quarkus Infinispan Client extension to connect to interact with Infinispan.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>解决方案</h2>
<div class="sectionbody">
<div class="paragraph">
<p>我们建议您按照下一节的说明逐步创建应用程序。然而，您可以直接转到已完成的示例。</p>
</div>
<div class="paragraph">
<p>克隆 Git 仓库： <code>git clone -b 3.2 <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> ，或者下载 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/3.2.zip">存档</a> 。</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>infinispan-client-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/3.2/infinispan-client-quickstart">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project"><a class="anchor" href="#creating-the-maven-project"></a>创建Maven项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>首先，我们需要一个新的项目。使用以下命令创建一个新的项目:</p>
</div>
<div class="sidebarblock primary asciidoc-tabs-sync-cli">
<div class="content">
<div class="title">CLI</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus create app org.acme:infinispan-client-quickstart \
    --extension='infinispan-client,resteasy-reactive' \
    --no-code
cd infinispan-client-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建Grade项目，请添加 <code>--gradle</code> 或者 <code>--gradle-kotlin-dsl</code> 参数。</p>
</div>
<div class="paragraph">
<p>For more information about how to install and use the Quarkus CLI, see the <a href="cli-tooling">Quarkus CLI</a> guide.</p>
</div>
</div>
</div>
<div class="sidebarblock secondary asciidoc-tabs-sync-maven">
<div class="content">
<div class="title">Maven</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus.platform:quarkus-maven-plugin:3.2.12.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=infinispan-client-quickstart \
    -Dextensions='infinispan-client,resteasy-reactive' \
    -DnoCode
cd infinispan-client-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建Grade项目，请添加 <code>-DbuildTool=gradle</code> 或者 <code>-DbuildTool=gradle-kotlin-dsl</code> 参数。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This command generates a new project, importing the Infinispan Client extension.</p>
</div>
<div class="paragraph">
<p>If you already have your Quarkus project configured, you can add the <code>infinispan-client</code> extension
to your project by running the following command in your project base directory:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus extension add 'infinispan-client'</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:add-extension -Dextensions='infinispan-client'</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew addExtension --extensions='infinispan-client'</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会将以下内容添加到你的构建文件中:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-infinispan-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-infinispan-client")
annotationProcessor 'org.infinispan.protostream:protostream-processor:4.6.1.Final' <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mandatory in the Gradle build to enable the generation of the files in the annotation based serialization</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-greeting-pojo"><a class="anchor" href="#creating-the-greeting-pojo"></a>Creating the Greeting POJO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are going to model our increments using the <code>Greeting</code> POJO.
Create the <code>src/main/java/org/acme/infinispan/client/Greeting.java</code> file, with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.infinispan.client;

import org.infinispan.protostream.annotations.ProtoFactory;
import org.infinispan.protostream.annotations.ProtoField;

public class Greeting { <i class="conum" data-value="1"></i><b>(1)</b>
   @ProtoField(number = 1) <i class="conum" data-value="2"></i><b>(2)</b>
   public String name;

   @ProtoField(number = 2) <i class="conum" data-value="3"></i><b>(3)</b>
   public String message;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If your classes have only mutable fields, then the <code>ProtoFactory</code> annotation is not required
is not required, assuming your class has a no arg constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@ProtoField</code> annotation to add the name field as string in the generated Protobuf schema</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@ProtoField</code> annotation to add the message field as string in the generated Protobuf schema</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that we are not going to use Java serialization. <a href="https://github.com/infinispan/protostream">Protostream</a> is
a serialization library based on Protobuf data format part of Infinispan. Using an annotation based API, we
will store our data in Protobuf format.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-greeting-schema"><a class="anchor" href="#creating-the-greeting-schema"></a>Creating the Greeting Schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are going to create our serialization schema using the <code>GreetingSchema</code> interface.
Create the <code>src/main/java/org/acme/infinispan/client/GreetingSchema.java</code> file, with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.infinispan.client;

import org.infinispan.protostream.GeneratedSchema;
import org.infinispan.protostream.annotations.AutoProtoSchemaBuilder;

@AutoProtoSchemaBuilder(includeClasses = Greeting.class) <i class="conum" data-value="1"></i><b>(1)</b>
public interface GreetingSchema extends GeneratedSchema { <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Includes the <code>Greeting</code> pojo with the <code>@AutoProtoSchemaBuilder</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Extends <code>GeneratedSchema</code> Protostream API interface</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Protobuf Schema that will be generated and used both on client and Infinispan Server side, will have
the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-protobuf hljs" data-lang="protobuf">// File name: GreetingSchema.proto
// Generated from : org.acme.infinispan.client.GreetingSchema

syntax = "proto2";

message Greeting {

   optional string name = 1;

   optional string message = 2;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-infinispan-greeting-resource"><a class="anchor" href="#creating-the-infinispan-greeting-resource"></a>Creating the Infinispan Greeting Resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create the <code>src/main/java/org/acme/infinispan/client/InfinispanGreetingResource.java</code> file, with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.infinispan.client;

import io.quarkus.infinispan.client.Remote;
import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.POST;
import jakarta.ws.rs.Path;
import org.infinispan.client.hotrod.RemoteCache;

import java.util.concurrent.CompletionStage;

@Path("/greeting")
public class InfinispanGreetingResource {

    @Inject
    @Remote("mycache") <i class="conum" data-value="1"></i><b>(1)</b>
    RemoteCache&lt;String, Greeting&gt; cache; <i class="conum" data-value="2"></i><b>(2)</b>

    @POST
    @Path("/{id}")
    public CompletionStage&lt;String&gt; postGreeting(String id, Greeting greeting) {
        return cache.putAsync(id, greeting) <i class="conum" data-value="3"></i><b>(3)</b>
              .thenApply(g -&gt; "Greeting done!")
              .exceptionally(ex -&gt; ex.getMessage());
    }

    @GET
    @Path("/{id}")
    public CompletionStage&lt;Greeting&gt; getGreeting(String id) {
        return cache.getAsync(id); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the <code>@Remote</code> annotation to use a cache. If the cache does not exist, will be created with a
default configuration <strong>on first access</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>RemoteCache</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Put the greeting id as a key and the Greeting pojo as a value</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get the greeting by id as the key</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-test-class"><a class="anchor" href="#creating-the-test-class"></a>创建测试类</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Edit the <code>pom.xml</code> file to add the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.rest-assured&lt;/groupId&gt;
    &lt;artifactId&gt;rest-assured&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the <code>src/test/java/org/acme/infinispan/client/InfinispanGreetingResourceTest.java</code> file with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.infinispan.client;

import io.quarkus.test.junit.QuarkusTest;
import io.restassured.http.ContentType;
import org.junit.jupiter.api.Test;

import static io.restassured.RestAssured.given;
import static org.hamcrest.CoreMatchers.is;

@QuarkusTest
class InfinispanGreetingResourceTest {

    @Test
    public void testHelloEndpoint() {
        given()
              .contentType(ContentType.JSON)
              .body("{\"name\":\"Infinispan Client\",\"message\":\"Hello World, Infinispan is up!\"}")
              .when()
              .post("/greeting/quarkus")
              .then()
              .statusCode(200);

        given()
                .when().get("/greeting/quarkus")
                .then()
                .statusCode(200)
                .body(is("{\"name\":\"Infinispan Client\",\"message\":\"Hello World, Infinispan is up!\"}"));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-it-running"><a class="anchor" href="#get-it-running"></a>让它运行起来</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We just need to run the application using:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="paragraph">
<p>We should have the Infinispan server running thanks to the Dev Services.
We can access the Dev Services UI through <code><a href="http://localhost:8080/q/dev/" class="bare">http://localhost:8080/q/dev/</a></code>.
The Dev UI should display the Infinispan UI Panel.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/dev-ui-infinispan.png" alt="Dev UI Infinispan" width="40%">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Click on the Web Console link and log using <code>admin</code> and <code>password</code> default credentials.
Quarkus has uploaded into the Schemas Tab the Protobuf Schema that is needed to marshall on the server the
Greeting POJO with Protobuf.
Check the <a href="infinispan-dev-services">Infinispan Dev Services Guide</a> to learn more.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interacting-with-the-greeting-service"><a class="anchor" href="#interacting-with-the-greeting-service"></a>Interacting with the Greeting Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we have seen above, the Greeting API exposes two Rest endpoints.
In this section we are going to see how to create and display a greeting message.</p>
</div>
<div class="sect2">
<h3 id="creating-a-greeting-message"><a class="anchor" href="#creating-a-greeting-message"></a>Creating a Greeting Message</h3>
<div class="paragraph">
<p>With the following command, we will create a greeting message with the id <code>quarkus</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST http://localhost:8080/greeting/quarkus -H "Content-Type: application/json" -d '{"name" : "Infinispan Client", "message":"Hello World, Infinispan is up!"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service should respond with a <code>Greeting added!</code> message.</p>
</div>
</div>
<div class="sect2">
<h3 id="displaying-a-greeting-message"><a class="anchor" href="#displaying-a-greeting-message"></a>Displaying a Greeting Message</h3>
<div class="paragraph">
<p>With the following command, we will display the greeting message with the id <code>quarkus</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl  http://localhost:8080/greeting/quarkus</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service should respond with the following json content.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name" : "Infinispan Client",
  "message" : "Hello World, Infinispan is up!"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="display-the-cache-and-content-with-the-infinispan-server-console"><a class="anchor" href="#display-the-cache-and-content-with-the-infinispan-server-console"></a>Display the cache and content with the Infinispan Server Console</h3>
<div class="paragraph">
<p>If a requested cache does not exist, Quarkus creates a cache with a Default configuration on first access.
We should be able to reaload the Infinispan Server Console and display the content of the Cache.
The Infinispan Server Console uses the <a href="https://infinispan.org/docs/stable/titles/rest/rest.html">Infinispan Server REST API</a>.
The content can be displayed in JSON thanks to the Protobuf Encoding that converts to JSON format.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/infinispan-console-client-guide.png" alt="Infinispan Console" width="90%">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-for-production"><a class="anchor" href="#configuring-for-production"></a>Configuring for production</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point, Quarkus uses the Infinispan Dev Service to run an Infinispan server and configure the application.
However, in production, you will run your own Infinispan (or Red Hat Data Grid).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start an Infinispan server on the port 11222 using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker run -it -p 11222:11222 -e USER="admin" -e PASS="password" quay.io/infinispan/server:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, open the <code>src/main/resources/application.properties</code> file and add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">%prod.quarkus.infinispan-client.hosts=localhost:11222 <i class="conum" data-value="1"></i><b>(1)</b>
%prod.quarkus.infinispan-client.username=admin <i class="conum" data-value="2"></i><b>(2)</b>
%prod.quarkus.infinispan-client.password=password <i class="conum" data-value="3"></i><b>(3)</b>

## Docker 4 Mac workaround. Uncomment only if you are using Docker for Mac.
## Read more about it in the Infinispan Reference Guide
# %prod.quarkus.infinispan-client.client-intelligence=BASIC <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets Infinispan Server address list, separated with commas</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the authentication username</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sets the authentication password</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sets the client intelligence. Use BASIC as a workaround if using Docker for Mac.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Client intelligence changes impact your performance in production.
Don&#8217;t change the client intelligence unless strictly necessary for your case.
Read more in the <a href="infinispan-client-reference">Infinispan Client extension reference guide</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="packaging-and-running-in-jvm-mode"><a class="anchor" href="#packaging-and-running-in-jvm-mode"></a>打包，并在JVM模式下运行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>你可以将应用打包为一个传统的jar文件，然后运行。</p>
</div>
<div class="paragraph">
<p>首先，需要打包：</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This command will start an Infinispan instance to execute the tests.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>然后运行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -jar target/quarkus-app/quarkus-run.jar</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-native"><a class="anchor" href="#running-native"></a>以本机可执行文件运行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>无需对源代码做任何修改，就可以将应用程序构建为一个本地可执行文件。本地可执行文件消除了对JVM的依赖，它包含了在目标平台上运行应用程序所需的一切，使应用程序能够以最小的资源开销运行。</p>
</div>
<div class="paragraph">
<p>编译一个本地可执行文件需要很长的时间，因为GraalVM会执行额外的步骤来删除不必要的代码路径。可使用 <code>native</code> profile来编译一个本地可执行文件：</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.package.type=native</code></pre>
</div>
</div>
<div class="paragraph">
<p>构建完成后，可以用以下命令运行可执行文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./target/infinispan-client-quickstart-1.0.0-SNAPSHOT-runner</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="going-further"><a class="anchor" href="#going-further"></a>进一步探索</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To learn more about the Quarkus Infinispan extension, check <a href="infinispan-client-reference">the Infinispan Client extension reference guide</a>.</p>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#prerequisites">先决条件</a></li>
<li><a href="#architecture">架构</a></li>
<li><a href="#solution">解决方案</a></li>
<li><a href="#creating-the-maven-project">创建Maven项目</a></li>
<li><a href="#creating-the-greeting-pojo">Creating the Greeting POJO</a></li>
<li><a href="#creating-the-greeting-schema">Creating the Greeting Schema</a></li>
<li><a href="#creating-the-infinispan-greeting-resource">Creating the Infinispan Greeting Resource</a></li>
<li><a href="#creating-the-test-class">创建测试类</a></li>
<li><a href="#get-it-running">让它运行起来</a></li>
<li><a href="#interacting-with-the-greeting-service">Interacting with the Greeting Service</a>
<ul class="sectlevel2">
<li><a href="#creating-a-greeting-message">Creating a Greeting Message</a></li>
<li><a href="#displaying-a-greeting-message">Displaying a Greeting Message</a></li>
<li><a href="#display-the-cache-and-content-with-the-infinispan-server-console">Display the cache and content with the Infinispan Server Console</a></li>
</ul>
</li>
<li><a href="#configuring-for-production">Configuring for production</a></li>
<li><a href="#packaging-and-running-in-jvm-mode">打包，并在JVM模式下运行</a></li>
<li><a href="#running-native">以本机可执行文件运行</a></li>
<li><a href="#going-further">进一步探索</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">博客</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">活动</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">新闻</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">路线图</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">开始体验</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
