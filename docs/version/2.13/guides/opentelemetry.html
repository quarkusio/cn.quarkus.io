<!DOCTYPE html>
<html lang="cn">







<head>
  <title>使用OpenTelemetry - 2.13 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.13/guides/opentelemetry" />
  <meta property="og:title" content="使用OpenTelemetry - 2.13" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/opentelemetry">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/2.13/guides/opentelemetry" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/2.13/guides/opentelemetry" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/2.13/guides/opentelemetry" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/2.13/guides/opentelemetry" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/2.13/guides/opentelemetry" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/2.13/guides/opentelemetry">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUS是什么？</a></li>
          <li><a href="/developer-joy" class="">开发者的乐趣 </a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES 原生</a></li>
          <li><a href="/standards" class="">标准</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">容器优先 </a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入门</a></li>
          <li><a href="/guides" class="active" >指南</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP视频</a></li>          
          <li><a href="/books" class="">书籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">浏览扩展</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">使用扩展</a></li>
          <li><a href="/guides/writing-extensions" class="" >创建扩展</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">支持</a></li>
          <li><a href="/blog" class="" >博客</a></li>
          <li><a href="/discussion" class="">讨论</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="" >播客</a></li>
          <li><a href="/events" class="">活动</a></li>
          <li><a href="/newsletter" class="">新闻</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">路线图</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">开始编码</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/2.13/guides/opentelemetry" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/2.13/guides/opentelemetry">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/2.13/guides/opentelemetry">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/2.13/guides/opentelemetry">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/2.13/guides/opentelemetry">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    





<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/2.13/guides/">返回指南目录</a>
    </div>
    <div class="flexlabel">
      <label>选择指南版本</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.32.1 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      <h1 class="text-caps">使用OpenTelemetry </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本指南解释了您的Quarkus应用程序如何利用 <a href="https://opentelemetry.io/">OpenTelemetry</a> 来为交互式Web应用提供分布式跟踪服务。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>先决条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>完成这个指南，你需要:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>大概15分钟</p>
</li>
<li>
<p>编辑器</p>
</li>
<li>
<p>安装JDK 11以上版本并正确配置了 <code>JAVA_HOME</code></p>
</li>
<li>
<p>Apache Maven 3.8.6</p>
</li>
<li>
<p>Docker and Docker Compose or <a href="podman">Podman</a>, and Docker Compose</p>
</li>
<li>
<p>如果你愿意的话，还可以选择使用<a href="cli-tooling">Quarkus CLI</a></p>
</li>
<li>
<p>如果你想构建原生可执行程序，可以选择安装Mandrel或者GraalVM，并<a href="building-native-image#configuring-graalvm">正确配置</a>(或者使用Docker在容器中进行构建)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>架构</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本指南中，我们创建了一个简单的REST应用程序来演示分布式跟踪服务。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>解决方案</h2>
<div class="sectionbody">
<div class="paragraph">
<p>我们建议您按照下面几节的说明，一步一步地创建应用程序。不过，您可以直接跳到已完成的例子。</p>
</div>
<div class="paragraph">
<p>克隆 Git 仓库： <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> ，或者下载 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">存档</a> 。</p>
</div>
<div class="paragraph">
<p>该解决方案位于 <code>opentelemetry-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/opentelemetry-quickstart">目录</a>中。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project"><a class="anchor" href="#creating-the-maven-project"></a>创建Maven项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>首先，我们需要一个新的项目。使用以下命令创建一个新的项目:</p>
</div>
<div class="sidebarblock primary asciidoc-tabs-sync-cli">
<div class="content">
<div class="title">CLI</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus create app org.acme:opentelemetry-quickstart \
    --stream=2.13 \
    --extension='resteasy-reactive,quarkus-opentelemetry-exporter-otlp' \
    --no-code
cd opentelemetry-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建Grade项目，请添加 <code>--gradle</code> 或者 <code>--gradle-kotlin-dsl</code> 参数。</p>
</div>
<div class="paragraph">
<p><em>关于如何安装并使用Quarkus CLI的更多信息，请参考<a href="cli-tooling">Quarkus CLI指南</a>。</em></p>
</div>
</div>
</div>
<div class="sidebarblock secondary asciidoc-tabs-sync-maven">
<div class="content">
<div class="title">Maven</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus.platform:quarkus-maven-plugin:2.13.9.Final:create \
    -DplatformVersion=2.13.9.Final \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=opentelemetry-quickstart \
    -Dextensions='resteasy-reactive,quarkus-opentelemetry-exporter-otlp' \
    -DnoCode
cd opentelemetry-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建Grade项目，请添加 <code>-DbuildTool=gradle</code> 或者 <code>-DbuildTool=gradle-kotlin-dsl</code> 参数。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>该命令生成Maven项目并导入 <code>quarkus-opentelemetry-exporter-otlp</code> 扩展，其中包括OpenTelemetry支持，以及 <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md">OTLP</a> 的gRPC span exporter。</p>
</div>
<div class="paragraph">
<p>如果您已经配置了您的Quarkus项目，您可以通过在您的项目根目录下运行以下命令，将 <code>quarkus-opentelemetry-exporter-otlp</code> 扩展添加到您的项目中：</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus extension add 'opentelemetry-otlp-exporter'</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:add-extension -Dextensions='opentelemetry-otlp-exporter'</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew addExtension --extensions='opentelemetry-otlp-exporter'</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会将以下内容添加到你的构建文件中:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-opentelemetry-exporter-otlp&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-opentelemetry-exporter-otlp")</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="examine-the-jax-rs-resource"><a class="anchor" href="#examine-the-jax-rs-resource"></a>检查JAX-RS资源</h3>
<div class="paragraph">
<p>创建一个 <code>src/main/java/org/acme/opentelemetry/TracedResource.java</code> 文件，内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.opentelemetry;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import org.jboss.logging.Logger;

@Path("/hello")
public class TracedResource {

    private static final Logger LOG = Logger.getLogger(TracedResource.class);

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        LOG.info("hello");
        return "hello";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，应用程序中没有包含任何关于追踪的代码。默认情况下，不需要修改任何必要的代码就可以实现对发送到这个节点的请求进行追踪。</p>
</div>
</div>
<div class="sect2">
<h3 id="create-the-configuration"><a class="anchor" href="#create-the-configuration"></a>创建配置</h3>
<div class="paragraph">
<p>有两种方法可以在应用程序中配置OTLP gRPC exporter。</p>
</div>
<div class="paragraph">
<p>第一种方法是通过在 <code>src/main/resources/application.properties</code> 文件内提供配置:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.application.name=myservice <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.opentelemetry.enabled=true <i class="conum" data-value="2"></i><b>(2)</b>
quarkus.opentelemetry.tracer.exporter.otlp.endpoint=http://localhost:4317 <i class="conum" data-value="3"></i><b>(3)</b>

quarkus.opentelemetry.tracer.exporter.otlp.headers=Authorization=Bearer my_secret <i class="conum" data-value="4"></i><b>(4)</b>

quarkus.log.console.format=%d{HH:mm:ss} %-5p traceId=%X{traceId}, parentId=%X{parentId}, spanId=%X{spanId}, sampled=%X{sampled} [%c{2.}] (%t) %s%e%n  <i class="conum" data-value="5"></i><b>(5)</b>

# Alternative to the console log
quarkus.http.access-log.pattern="...traceId=%{X,traceId} spanId=%{X,spanId}" <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>所有从应用程序创建的spans将包含一个OpenTelemetry <code>Resource</code> ，表明该span是由 <code>myservice</code> 应用程序创建。如果没有设置，它将默认为artifact id。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>OpenTelemetry是否已启用。默认是 <code>true</code> ，但放在这里是用来展示如何禁用它</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>用于发送spans的gRPC节点</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>可选的gRPC消息头，通常用于认证</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add tracing information into log message.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can also only put the trace info into the access log. In this case you must omit the info in the console log format.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run-the-application"><a class="anchor" href="#run-the-application"></a>运行应用程序</h2>
<div class="sectionbody">
<div class="paragraph">
<p>第一步是配置和启动 <a href="https://opentelemetry.io/docs/collector/">OpenTelemetry Collector</a> ，以接收、处理和输出勘测数据到 <a href="https://www.jaegertracing.io/">Jaeger</a> 来显示捕获的traces。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jaeger supports the OTel protocols out of the box since version 1.35.
In this case you do not need to install the collector but can directly send the trace data to Jaeger (after enabling OTLP receivers there, see e.g. this
<a href="https://medium.com/jaegertracing/introducing-native-support-for-opentelemetry-in-jaeger-eb661be8183c">blog entry</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>通过创建一个 <code>otel-collector-config.yaml</code> 文件来配置OpenTelemetry Collector：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">receivers:
  otlp:
    protocols:
      grpc:
        endpoint: otel-collector:4317

exporters:
  jaeger:
    endpoint: jaeger-all-in-one:14250
    tls:
      insecure: true

processors:
  batch:

extensions:
  health_check:

service:
  extensions: [health_check]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [jaeger]</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以通过 <code>docker-compose up -d</code> 命令和下面的 <code>docker-compose.yml</code> 文件来启动OpenTelemetry Collector和Jaeger系统：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: "2"
services:

  # Jaeger
  jaeger-all-in-one:
    image: jaegertracing/all-in-one:latest
    ports:
      - "16686:16686"
      - "14268:14268"
      - "14250:14250"
  # Collector
  otel-collector:
    image: otel/opentelemetry-collector:latest
    command: ["--config=/etc/otel-collector-config.yaml"]
    volumes:
      - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml:Z
    ports:
      - "13133:13133" # Health_check extension
      - "4317:4317"   # OTLP gRPC receiver
    depends_on:
      - jaeger-all-in-one</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在我们准备运行我们的应用程序。如果使用 <code>application.properties</code> 来配置tracer：</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者如果通过JVM参数配置OTLP gRPC节点：</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev -Djvm.args="-Dquarkus.opentelemetry.tracer.exporter.otlp.endpoint=http://localhost:4317"</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev -Djvm.args="-Dquarkus.opentelemetry.tracer.exporter.otlp.endpoint=http://localhost:4317"</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev -Djvm.args="-Dquarkus.opentelemetry.tracer.exporter.otlp.endpoint=http://localhost:4317"</code></pre>
</div>
</div>
<div class="paragraph">
<p>在OpenTelemetry Collector、Jaeger系统和应用程序运行的情况下，您可以向指定的节点发出请求：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ curl http://localhost:8080/hello
hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the first request has been submitted, you will be able to see the tracing information in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">10:49:02 INFO  traceId=, parentId=, spanId=, sampled= [io.quarkus] (main) Installed features: [cdi, opentelemetry, opentelemetry-otlp-exporter, rest-client, resteasy, smallrye-context-propagation, vertx]
10:49:03 INFO  traceId=17ceb8429b9f25b0b879fa1503259456, parentId=3125c8bee75b7ad6, spanId=58ce77c86dd23457, sampled=true [or.ac.op.TracedResource] (executor-thread-1) hello
10:49:03 INFO  traceId=ad23acd6d9a4ed3d1de07866a52fa2df, parentId=, spanId=df13f5b45cf4d1e2, sampled=true [or.ac.op.TracedResource] (executor-thread-0) hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后访问 <a href="http://localhost:16686">Jaeger界面</a> 来查看追踪信息。</p>
</div>
<div class="paragraph">
<p>使用 <code>CTRL+C</code> 来停止应用程序。</p>
</div>
<div class="sect2">
<h3 id="jdbc"><a class="anchor" href="#jdbc"></a>JDBC</h3>
<div class="paragraph">
<p>通过<a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation/tree/main/instrumentation/jdbc/library">JDBC instrumentation</a> 可以为您的应用程序的每个JDBC查询添加一个span。要启用它，请在您的构建文件中添加以下依赖：</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.opentelemetry.instrumentation&lt;/groupId&gt;
    &lt;artifactId&gt;opentelemetry-jdbc&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.opentelemetry.instrumentation:opentelemetry-jdbc")</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于它使用专用的JDBC驱动，您必须配置您的数据源和Hibernate ORM来使用它。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.datasource.db-kind=postgresql
# add ':otel' to your database URL
quarkus.datasource.jdbc.url=jdbc:otel:postgresql://localhost:5432/mydatabase
# use the 'OpenTelemetryDriver' instead of the one for your database
quarkus.datasource.jdbc.driver=io.opentelemetry.instrumentation.jdbc.OpenTelemetryDriver
# configure Hibernate ORM dialect
quarkus.hibernate-orm.dialect=org.hibernate.dialect.PostgreSQLDialect</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-configuration"><a class="anchor" href="#additional-configuration"></a>其他配置</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有些情况下需要对OpenTelemetry进行自定义配置。以下章节将展示如何对一些必要的属性进行正确配置。</p>
</div>
<div class="sect2">
<h3 id="id-generator"><a class="anchor" href="#id-generator"></a>ID生成器（ID Generator）</h3>
<div class="paragraph">
<p>OpenTelemetry扩展将默认使用一个随机的 <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/trace/sdk.md#id-generators">ID发生器</a> 来创建trace和span标识符。</p>
</div>
<div class="paragraph">
<p>一些供应商特定协议需要一个自定义的ID生成器，您可以通过创建一个自定义生成器来覆盖默认的ID。OpenTelemetry扩展将检测 <code>IdGenerator</code> CDI Bean，并在配置tracer生成器时使用它。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class CustomConfiguration {

    /** Creates a custom IdGenerator for OpenTelemetry */
    @Produces
    @Singleton
    public IdGenerator idGenerator() {
        return AwsXrayIdGenerator.getInstance();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="propagators"><a class="anchor" href="#propagators"></a>Propagators</h3>
<div class="paragraph">
<p>OpenTelemetry propagates cross-cutting concerns through <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/context/api-propagators.md">propagators</a> that will share an underlying <code>Context</code> for storing state and accessing
data across the lifespan of a distributed transaction.</p>
</div>
<div class="paragraph">
<p>默认情况下，OpenTelemetry扩展启用了 <a href="https://www.w3.org/TR/trace-context/">W3C Trace Context</a> 和 <a href="https://www.w3.org/TR/baggage/">W3C Baggage</a> propagators，但是您可以通过设置 <a href="#configuration-reference">[参考配置</a>] 中描述的 <code>propagators</code> 配置来选择任何支持的OpenTelemetry propagators。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>b3</code> , <code>b3multi</code> , <code>jaeger</code> 和 <code>ottrace</code> propatagors 需要将 <a href="https://github.com/open-telemetry/opentelemetry-java/tree/main/extensions/trace-propagators">trace-propagators</a> 扩展作为一个依赖添加到您的项目中。</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.opentelemetry&lt;/groupId&gt;
    &lt;artifactId&gt;opentelemetry-extension-trace-propagators&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.opentelemetry:opentelemetry-extension-trace-propagators")</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>xray</code> propagator需要将 <a href="https://github.com/open-telemetry/opentelemetry-java/tree/main/extensions/aws">aws</a> 扩展作为依赖添加到您的项目中。</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.opentelemetry&lt;/groupId&gt;
    &lt;artifactId&gt;opentelemetry-extension-aws&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.opentelemetry:opentelemetry-extension-aws")</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="resource"><a class="anchor" href="#resource"></a>资源</h3>
<div class="paragraph">
<p>Opentelemetry <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/overview.md#resources">资源</a> 是产生telemetry的实体的表示，它向输出的trace中添加属性，用以描述谁在产生trace。</p>
</div>
<div class="paragraph">
<p>You can add attributes by setting the <code>resource-attributes</code> tracer config that is described in the <a href="#configuration-reference">OpenTelemetry参考配置</a>.
Since this property can be overridden at runtime, the OpenTelemetry extension will pick up its value following the order of precedence that
is described in the <a href="config-reference#configuration-sources">Quarkus Configuration Reference</a>.</p>
</div>
<div class="paragraph">
<p>如果通过您需要的任何方式来使用自定义的资源或由 <a href="https://github.com/open-telemetry/opentelemetry-java/tree/main/sdk-extensions">OpenTelemetry SDK扩展</a> 之一提供的资源，您可以创建多个资源生产者。OpenTelemetry扩展将检测 <code>Resource</code> CDI beans，并在配置tracer生成器时将其合并。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class CustomConfiguration {

    @Produces
    @ApplicationScoped
    public Resource osResource() {
        return OsResource.get();
    }

    @Produces
    @ApplicationScoped
    public Resource ecsResource() {
        return EcsResource.get();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sampler"><a class="anchor" href="#sampler"></a>采样器(Sampler)</h3>
<div class="paragraph">
<p>Opentelemetry <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/trace/sdk.md#sampling">采样器</a> 决定了是否应该对一个trace进行采样和输出，通过减少收集和发送至exporter的trace样本数量来控制噪音和开销。</p>
</div>
<div class="paragraph">
<p>您可以通过设置 <a href="#configuration-reference">[参考配置</a>] 中提到的必要的采样器配置来简单地设置一个 <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/trace/sdk.md#built-in-samplers">内置采样器</a>。</p>
</div>
<div class="paragraph">
<p>如果您需要使用一个自定义的采样器或使用一个由 <a href="https://github.com/open-telemetry/opentelemetry-java/tree/main/sdk-extensions">OpenTelemetry SDK扩展</a> 提供的采样器，您可以创建一个采样器生成器。OpenTelemetry扩展将检测到 <code>Sampler</code> CDI bean，并在配置tracer生成器时使用它。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class CustomConfiguration {

    /** Creates a custom sampler for OpenTelemetry */
    @Produces
    @Singleton
    public Sampler sampler() {
        return JaegerRemoteSampler.builder()
        .setServiceName("my-service")
        .build();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-instrumentation"><a class="anchor" href="#additional-instrumentation"></a>其他的植入(instrumentation)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>一些Quarkus扩展需要额外的代码来确保traces被传播到后续执行中。以下章节将展示跨越进程边界传播traces的必要条件。</p>
</div>
<div class="paragraph">
<p>本节中用到的植入方式已经过Quarkus测试，并且在标准和本地模式下都能工作。</p>
</div>
<div class="sect2">
<h3 id="cdi"><a class="anchor" href="#cdi"></a>CDI</h3>
<div class="paragraph">
<p>在任何CDI可感知的Bean中用 <code>io.opentelemetry.extension.annotations.WithSpan</code> 注解来注释一个方法将会创建一个新的Span，并与当前Trace上下文建立所需要的任何关系。</p>
</div>
<div class="paragraph">
<p>方法参数可以使用 <code>io.opentelemetry.extension.annotations.SpanAttribute</code> 注解进行注释，来表示哪些方法参数是包含在Trace中的。</p>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
class SpanBean {
    @WithSpan
    void span() {

    }

    @WithSpan("name")
    void spanName() {

    }

    @WithSpan(kind = SERVER)
    void spanKind() {

    }

    @WithSpan
    void spanArgs(@SpanAttribute(value = "arg") String arg) {

    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="smallrye-reactive-messaging-kafka"><a class="anchor" href="#smallrye-reactive-messaging-kafka"></a>SmallRye Reactive Messaging - Kafka</h3>
<div class="paragraph">
<p>当使用 SmallRye Reactive Messaging  的 Kafka 扩展时，我们可以向Kafka记录中传播span，通过：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TracingMetadata tm = TracingMetadata.withPrevious(Context.current());
Message out = Message.of(...).withMetadata(tm);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above creates a <code>TracingMetadata</code> object we can add to the <code>Message</code> being produced,
which retrieves the OpenTelemetry <code>Context</code> to extract the current span for propagation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-reference"><a class="anchor" href="#configuration-reference"></a>OpenTelemetry参考配置</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> Configuration property fixed at build time - All other configuration properties are overridable at runtime <input type="search" id="config-search-0" placeholder="FILTER CONFIGURATION" disabled></p>
</div>
<table class="tableblock frame-all grid-all stretch configuration-reference searchable configuration-reference-all-rows">
<colgroup>
<col style="width: 80%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a id="quarkus-opentelemetry_configuration"></a><a href="#quarkus-opentelemetry_configuration">Configuration property</a></p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">类型</p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">默认值</p></th>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-opentelemetry_quarkus.opentelemetry.enabled"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.enabled">quarkus.opentelemetry.enabled</a></code></p>
</div>
<div id="conf-collapsible-desc-1" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>OpenTelemetry support.
OpenTelemetry support is enabled by default.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14670">QUARKUS_OPENTELEMETRY_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14670" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> </p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-opentelemetry_quarkus.opentelemetry.propagators"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.propagators">quarkus.opentelemetry.propagators</a></code></p>
</div>
<div id="conf-collapsible-desc-2" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Comma separated list of OpenTelemetry propagators which must be supported.
Valid values are <code>b3, b3multi, baggage, jaeger, ottrace, tracecontext, xray</code>.
Default value is <code>traceContext,baggage</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14671">QUARKUS_OPENTELEMETRY_PROPAGATORS</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14671" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>tracecontext,baggage</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-opentelemetry_quarkus.opentelemetry.tracer.enabled"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.tracer.enabled">quarkus.opentelemetry.tracer.enabled</a></code></p>
</div>
<div id="conf-collapsible-desc-3" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Support for tracing with OpenTelemetry.
Support for tracing will be enabled if OpenTelemetry support is enabled and either this value is true, or this value is unset.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14672">QUARKUS_OPENTELEMETRY_TRACER_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14672" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry_quarkus.opentelemetry.tracer.resource-attributes"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.tracer.resource-attributes">quarkus.opentelemetry.tracer.resource-attributes</a></code></p>
</div>
<div id="conf-collapsible-desc-4" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>A comma separated list of name=value resource attributes that represents the entity producing telemetry (eg. <code>service.name=authservice</code>).</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14673">QUARKUS_OPENTELEMETRY_TRACER_RESOURCE_ATTRIBUTES</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14673" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry_quarkus.opentelemetry.tracer.sampler"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.tracer.sampler">quarkus.opentelemetry.tracer.sampler</a></code></p>
</div>
<div id="conf-collapsible-desc-5" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The sampler to use for tracing.
Valid values are <code>off, on, ratio</code>.
Defaults to <code>on</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14674">QUARKUS_OPENTELEMETRY_TRACER_SAMPLER</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14674" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>on</code></p></td>
</tr>
<tr class="">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry_quarkus.opentelemetry.tracer.sampler.ratio"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.tracer.sampler.ratio">quarkus.opentelemetry.tracer.sampler.ratio</a></code></p>
</div>
<div id="conf-non-collapsible-desc-6" class="openblock description">
<div class="content">
<div class="paragraph">
<p>Environment variable: <code id="env-var-14675">QUARKUS_OPENTELEMETRY_TRACER_SAMPLER_RATIO</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14675" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry_quarkus.opentelemetry.tracer.sampler.parent-based"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.tracer.sampler.parent-based">quarkus.opentelemetry.tracer.sampler.parent-based</a></code></p>
</div>
<div id="conf-collapsible-desc-7" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If the sampler to use for tracing is parent based.
Valid values are <code>true, false</code>.
Defaults to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14676">QUARKUS_OPENTELEMETRY_TRACER_SAMPLER_PARENT_BASED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14676" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> </p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry_quarkus.opentelemetry.tracer.suppress-non-application-uris"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.tracer.suppress-non-application-uris">quarkus.opentelemetry.tracer.suppress-non-application-uris</a></code></p>
</div>
<div id="conf-collapsible-desc-8" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Suppress non-application uris from trace collection. This will suppress tracing of <code>/q</code> endpoints.
Suppressing non-application uris is enabled by default.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14677">QUARKUS_OPENTELEMETRY_TRACER_SUPPRESS_NON_APPLICATION_URIS</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14677" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> </p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry_quarkus.opentelemetry.tracer.include-static-resources"></a><code><a href="#quarkus-opentelemetry_quarkus.opentelemetry.tracer.include-static-resources">quarkus.opentelemetry.tracer.include-static-resources</a></code></p>
</div>
<div id="conf-collapsible-desc-9" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Include static resources from trace collection.
Include static resources is disabled by default.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14678">QUARKUS_OPENTELEMETRY_TRACER_INCLUDE_STATIC_RESOURCES</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14678" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code> </p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> Configuration property fixed at build time - All other configuration properties are overridable at runtime <input type="search" id="config-search-1" placeholder="FILTER CONFIGURATION" disabled></p>
</div>
<table class="tableblock frame-all grid-all stretch configuration-reference searchable configuration-reference-all-rows">
<colgroup>
<col style="width: 80%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a id="quarkus-opentelemetry-exporter-otlp_configuration"></a><a href="#quarkus-opentelemetry-exporter-otlp_configuration">Configuration property</a></p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">类型</p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">默认值</p></th>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.enabled"></a><code><a href="#quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.enabled">quarkus.opentelemetry.tracer.exporter.otlp.enabled</a></code></p>
</div>
<div id="conf-collapsible-desc-10" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>OTLP SpanExporter support.
OTLP SpanExporter support is enabled by default.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14679">QUARKUS_OPENTELEMETRY_TRACER_EXPORTER_OTLP_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14679" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> </p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.endpoint"></a><code><a href="#quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.endpoint">quarkus.opentelemetry.tracer.exporter.otlp.endpoint</a></code></p>
</div>
<div id="conf-collapsible-desc-11" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The OTLP endpoint to connect to. The endpoint must start with either http:// or https://.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14680">QUARKUS_OPENTELEMETRY_TRACER_EXPORTER_OTLP_ENDPOINT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14680" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.headers"></a><code><a href="#quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.headers">quarkus.opentelemetry.tracer.exporter.otlp.headers</a></code></p>
</div>
<div id="conf-collapsible-desc-12" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Key-value pairs to be used as headers associated with gRPC requests. The format is similar to the <code>OTEL_EXPORTER_OTLP_HEADERS</code> environment variable, a list of key-value pairs separated by the "=" character. See <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/exporter.md#specifying-headers-via-environment-variables">Specifying headers</a> for more details.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14681">QUARKUS_OPENTELEMETRY_TRACER_EXPORTER_OTLP_HEADERS</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14681" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.export-timeout"></a><code><a href="#quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.export-timeout">quarkus.opentelemetry.tracer.exporter.otlp.export-timeout</a></code></p>
</div>
<div id="conf-collapsible-desc-13" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The maximum amount of time to wait for the collector to process exported spans before an exception is thrown. A value of <code>0</code> will disable the timeout: the exporter will continue waiting until either exported spans are processed, or the connection fails, or is closed for some other reason.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14682">QUARKUS_OPENTELEMETRY_TRACER_EXPORTER_OTLP_EXPORT_TIMEOUT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14682" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html">Duration</a>
  <a href="#duration-note-anchor-{summaryTableId}" title="More information about the Duration format"><span class="icon"><i class="fa fa-question-circle"></i></span></a></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>10S</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.compression"></a><code><a href="#quarkus-opentelemetry-exporter-otlp_quarkus.opentelemetry.tracer.exporter.otlp.compression">quarkus.opentelemetry.tracer.exporter.otlp.compression</a></code></p>
</div>
<div id="conf-collapsible-desc-14" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Compression method to be used by exporter to compress the payload.
See <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/exporter.md#opentelemetry-protocol-exporter">Configuration Options</a> for the supported compression methods.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-14683">QUARKUS_OPENTELEMETRY_TRACER_EXPORTER_OTLP_COMPRESSION</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-14683" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
</tbody>
</table>
<div id="duration-note-anchor-quarkus-opentelemetry-exporter-otlp" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">About the Duration format</div>
<div class="paragraph">
<p>持续时间的格式使用标准的 <code>java.time.Duration</code> 格式您可以在 <a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#parse-java.lang.CharSequence-">Duration#parse() javadoc</a> 中了解更多信息。</p>
</div>
<div class="paragraph">
<p>您还可以提供以数字开头的持续时间值。 在这种情况下，如果该值仅包含一个数字，则转换器将该值视为秒。 否则，<code>PT</code> 会隐式添加到值的前面，以获得标准的`java.time.Duration` 格式。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#prerequisites">先决条件</a></li>
<li><a href="#architecture">架构</a></li>
<li><a href="#solution">解决方案</a></li>
<li><a href="#creating-the-maven-project">创建Maven项目</a>
<ul class="sectlevel2">
<li><a href="#examine-the-jax-rs-resource">检查JAX-RS资源</a></li>
<li><a href="#create-the-configuration">创建配置</a></li>
</ul>
</li>
<li><a href="#run-the-application">运行应用程序</a>
<ul class="sectlevel2">
<li><a href="#jdbc">JDBC</a></li>
</ul>
</li>
<li><a href="#additional-configuration">其他配置</a>
<ul class="sectlevel2">
<li><a href="#id-generator">ID生成器（ID Generator）</a></li>
<li><a href="#propagators">Propagators</a></li>
<li><a href="#resource">资源</a></li>
<li><a href="#sampler">采样器(Sampler)</a></li>
</ul>
</li>
<li><a href="#additional-instrumentation">其他的植入(instrumentation)</a>
<ul class="sectlevel2">
<li><a href="#cdi">CDI</a></li>
<li><a href="#smallrye-reactive-messaging-kafka">SmallRye Reactive Messaging - Kafka</a></li>
</ul>
</li>
<li><a href="#configuration-reference">OpenTelemetry参考配置</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">博客</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">活动</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">新闻</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">路线图</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">开始体验</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
