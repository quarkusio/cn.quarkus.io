msgid ""
msgstr ""
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Generator: jekyll-l10n\n"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "ArC migrates to Gizmo 2"
msgstr "ArC 迁移到 Gizmo 2"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"ArC got rewritten from Gizmo 1 to Gizmo 2. What does that mean for you?"
msgstr "ArC 从 Gizmo 1 重写为 Gizmo 2。这对你意味着什么？"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"ArC is Quarkus's implementation of CDI Lite.\n"
"Gizmo is a simplified bytecode generation library.\n"
"What do they have in common?"
msgstr "ArC 是 Quarkus 对 CDI Lite 的实现。Gizmo 是一个简化的字节码生成库。它们有什么共同点？"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"ArC has been using Gizmo 1 since approximately forever, but now that Gizmo 2 "
"is shaping up, some Quarkus components have started migrating to it.\n"
"I have started rewriting ArC to Gizmo 2 a few months ago, when we felt like "
"Gizmo 2 starts looking reasonable and some real-world experience was needed."
msgstr ""
"ArC 大约从很久以前就开始使用 Gizmo 1，但现在 Gizmo 2 已经成型，一些 Quarkus 组件已经开始迁移到 Gizmo "
"2。几个月前，当我们觉得 Gizmo 2 开始变得合理并需要一些实际经验时，我就开始将 ArC 重写为 Gizmo 2。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"This rewrite took several months, mostly because Gizmo 2 is a complete "
"rewrite and rearchitecture of Gizmo 1 and ArC is a heavy user, but also "
"because during the ArC rewrite, I found some Gizmo 2 issues and there were "
"several back and forths."
msgstr ""
"这次重写花了几个月的时间，主要是因为 Gizmo 2 是对 Gizmo 1 的完全重写和重新架构，而 ArC 是一个重度用户，但也因为在 ArC "
"重写期间，我发现了一些 Gizmo 2 的问题，并进行了几次来回讨论。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"To illustrate, I'll first go over the differences in Gizmo 1 and 2, and then "
"detail how that affects ArC users.\n"
"Spoiler alert: there's no change that would affect Quarkus applications.\n"
"All changes are in the APIs that are only exposed to extensions (at build "
"time)."
msgstr ""
"为了说明这一点，我将首先介绍 Gizmo 1 和 2 的不同之处，然后详细说明这对 ArC 用户的影响。剧透一下：没有任何变化会影响 Quarkus "
"应用程序。所有变化都发生在只向扩展程序开放的 API 中（在构建时）。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "Gizmo 1 vs Gizmo 2"
msgstr "Gizmo 1 vs Gizmo 2"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"First off, Gizmo 1 is based on ASM and Gizmo 2 is based on the ClassFile API "
"(not the one present in the JDK since link:https://openjdk.org/jeps/"
"484[version 24], but the link:https://github.com/dmlloyd/jdk-classfile-"
"backport[fork] maintained by David Lloyd, which supports Java 17).\n"
"The ClassFile API itself is very different to ASM, and since the ClassFile "
"API structure guided the Gizmo 2 API structure, that is also very different."
msgstr ""
"首先，Gizmo 1 基于 ASM，而 Gizmo 2 基于 ClassFile API（不是 JDK 第 link:https://openjdk."
"org/jeps/484[24 版] 以后的那个，而是 David Lloyd 维护的支持 Java 17 的 link:https://github."
"com/dmlloyd/jdk-classfile-backport[分叉] ）。ClassFile API 本身与 ASM 非常不同，而且由于 "
"ClassFile API 结构指导着 Gizmo 2 API 结构，因此也非常不同。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"To quickly compare, this is how you generate a \"Hello, World!\" program "
"with Gizmo 1:"
msgstr "为了快速比较，下面是使用 Gizmo 1 生成 \"Hello, World!\"程序的过程："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "And this is how you generate the same program with Gizmo 2:"
msgstr "这就是用 Gizmo 2 生成相同程序的方法："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"There are obvious surface-level differences in the API structure, but there "
"are also deeper differences.\n"
"I'll mention one here just as an example: the way Gizmo represents and "
"maintains values has changed significantly."
msgstr "API 结构有明显的表面差异，但也有更深层次的差异。这里我只举一个例子：Gizmo 表示和维护值的方式发生了很大变化。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"Gizmo 1 has the venerable `ResultHandle` class, which is almost always a "
"local variable (even though the API doesn't let you assign to it; you have "
"to use `AssignableResultHandle` for that).\n"
"This means you don't really have to care about order in which you produce "
"values or about using them multiple times -- everything just works.\n"
"There's obvious overhead though: for each use of the value, it needs to be "
"loaded from the variable to the stack."
msgstr ""
"Gizmo 1 拥有著名的 `ResultHandle` 类，它几乎总是一个局部变量（尽管 API 不允许对它进行赋值；必须使用 "
"`AssignableResultHandle` "
"）。这意味着你不必在意产生值的顺序，也不必多次使用它们，一切都能正常工作。不过，这样做的开销也是显而易见的：每次使用数值时，都需要将其从变量加载到堆栈中。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"On the other hand, Gizmo 2 represents values as ``Expr``s, which are _not_ "
"local variables:"
msgstr "另一方面，Gizmo 2 将数值表示为 `Expr` s，这 _不是_ 局部变量："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"An `Expr` is a value that is, at the time of its creation, on top of the "
"stack, nothing more.\n"
"This means the order of producing values suddenly matters and they may not "
"be reused!\n"
"To create a local variable (`LocalVar`) out of an expression, you have to "
"explicitly call a method:"
msgstr ""
"`Expr` 是一个值，在创建时位于堆栈顶部，仅此而已。这意味着产生值的顺序突然变得很重要，而且这些值不能重复使用！要从表达式中创建一个局部变量 ( "
"`LocalVar` )，必须明确调用一个方法："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"There are a lot more concepts not shown in these examples, which you can "
"read about in the documentation.\n"
"The Gizmo 1 documentation is available at https://github.com/quarkusio/gizmo/"
"blob/1.x/USAGE.adoc, while the Gizmo 2 documentation (not yet complete) is "
"available at https://github.com/quarkusio/gizmo/blob/main/MANUAL.adoc."
msgstr ""
"这些示例中没有显示的概念还有很多，您可以在文档中阅读。Gizmo 1 文档可从 https://github.com/quarkusio/gizmo/"
"blob/1.x/USAGE.adoc 获取，而 Gizmo 2 文档（尚未完成）可从 https://github.com/quarkusio/"
"gizmo/blob/main/MANUAL.adoc 获取。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "ArC"
msgstr "ArC"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"Back to ArC.\n"
"Today, all bytecode generation in ArC is based on Gizmo 2 (if you want the "
"gory details, look at https://github.com/quarkusio/quarkus/pull/50708[this "
"pull request]), and it's going to be released in Quarkus 3.30."
msgstr ""
"回到 ArC。如今，ArC 中的所有字节码生成都基于 Gizmo 2（如果你想了解更多细节，请查看 link:https://github.com/"
"quarkusio/quarkus/pull/50708[此 pull request] ），它将在 Quarkus 3.30 中发布。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"ArC has several public APIs that expose Gizmo types.\n"
"This means that the rewrite to Gizmo 2 includes breaking changes.\n"
"These are unlikely to impact users -- in fact, the number of affected places "
"in the Quarkus core repository is surprisingly small.\n"
"However, in the interest of transparency, here's a full list of API "
"breakages:"
msgstr ""
"ArC 有几个公共 API 公开了 Gizmo 类型。这意味着 Gizmo 2 的重写包含了破坏性的改动。这些改动不太可能对用户造成影响--"
"事实上，Quarkus 核心资源库中受影响的地方少得出奇。不过，为了透明起见，这里列出了 API 破坏的完整列表："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "`BeanConfiguratorBase`: methods"
msgstr "`BeanConfiguratorBase` 方法"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "were changed to"
msgstr "改为"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "`ObserverConfigurator`: method"
msgstr "`ObserverConfigurator` 方法"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "was changed to"
msgstr "改为"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "`ContextConfigurator`: method"
msgstr "`ContextConfigurator` 方法"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "`BeanProcessor.Builder`: method"
msgstr "`BeanProcessor.Builder` 方法"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"Noone is expected to be affected by the last change, because that is in the "
"ArC integration API, which should only be used by the Quarkus ArC extension.\n"
"The other changes are in APIs that could legitimately be used:"
msgstr ""
"预计没有人会受到最后一项改动的影响，因为这是 ArC 集成 API 的改动，只有 Quarkus ArC 扩展才能使用。其他改动都是在可以合法使用的 "
"API 中："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "synthetic beans"
msgstr "人造豆"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "synthetic observers"
msgstr "合成观测器"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "custom contexts"
msgstr "自定义上下文"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"As you see, all these changes are similar.\n"
"The Gizmo 1 variant takes a `Consumer<MethodCreator>` (or, in one case, a "
"`Function<MethodCreator, ResultHandle>`).\n"
"The `MethodCreator` must be used to create the bytecode of the corresponding "
"method:"
msgstr ""
"如您所见，所有这些变化都大同小异。Gizmo 1 变体需要一个 `Consumer<MethodCreator>` （或者，在一种情况下，需要一个 "
"`Function<MethodCreator, ResultHandle>` ）。 `MethodCreator` 必须用于创建相应方法的字节码："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"`BeanConfiguratorBase.creator()`: create an instance of the synthetic bean"
msgstr "`BeanConfiguratorBase.creator()` 创建合成 bean 的实例"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"`BeanConfiguratorBase.destroyer()`: destroy an instance of the synthetic "
"bean"
msgstr "`BeanConfiguratorBase.destroyer()` ：销毁合成 bean 的实例"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"`BeanConfiguratorBase.checkActive()`: check if the synthetic bean is "
"currently active (niche use case, most likely unused outside of the core "
"Quarkus repository)"
msgstr ""
"`BeanConfiguratorBase.checkActive()` ：检查合成 bean 当前是否处于活动状态（利基用例，很可能在核心 "
"Quarkus 资源库之外未被使用）"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "`ObserverConfigurator.notify()`: notify the synthetic observer"
msgstr "`ObserverConfigurator.notify()` ：通知合成观测器"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"`ContextConfigurator.creator()`: create a context object of the custom "
"context"
msgstr "`ContextConfigurator.creator()` 创建自定义上下文对象"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"The Gizmo 2 variants no longer take a Gizmo object.\n"
"Instead, they take an ArC interface that provides access to all the "
"necessary Gizmo objects -- because more than 1 is necessary."
msgstr ""
"Gizmo 2 变体不再使用 Gizmo 对象。取而代之的是一个 ArC 接口，它提供了对所有必要的 Gizmo 对象的访问权限，因为需要的 Gizmo "
"对象不止一个。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"As mentioned above, most extensions should not be affected.\n"
"This is because higher-level APIs exist that do not expose bytecode "
"generation; either they use classes that implement interfaces, or they "
"accept results of recorder methods.\n"
"These higher-level APIs didn't change at all.\n"
"However, using the lower-level APIs is still permitted, so let's take a look "
"at how we'd migrate a simple synthetic bean creation function from Gizmo 1 "
"to Gizmo 2."
msgstr ""
"如上所述，大多数扩展都不会受到影响。这是因为存在着不公开字节码生成的更高层次的应用程序接口；它们要么使用实现接口的类，要么接受记录器方法的结果。这些高层 "
"API 完全没有变化。不过，我们仍然允许使用较低级的 API，因此让我们来看看如何将一个简单的合成 Bean 创建函数从 Gizmo 1 移植到 "
"Gizmo 2。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"Here's a simple synthetic bean registered using `SyntheticBeanBuildItem`:"
msgstr "下面是一个使用 `SyntheticBeanBuildItem` 注册的简单合成 bean："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"The `Consumer` here accepts a `MethodCreator` that provides direct access to "
"its parameters as well as to the class, from which one can read the fields."
msgstr "`Consumer` 接受一个 `MethodCreator` ，可直接访问其参数和类，并从中读取字段。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "After the rewrite to Gizmo 2, the code looks like:"
msgstr "重写为 Gizmo 2 后，代码看起来像这样："

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"The `Consumer` accepts `CreateGeneration` that provides access to the "
"`BlockCreator` to generate bytecode (`createMethod()`) and a number of "
"necessary variables.\n"
"In this example, we use the `paramsMap()` method to acccess the parameter "
"map."
msgstr ""
"`Consumer` 接受 `CreateGeneration` ， 可访问 `BlockCreator` 以生成字节码 ( "
"`createMethod()` ) 和一些必要的变量。在本例中，我们使用 `paramsMap()` 方法访问参数映射。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"The other APIs have changed in the same manner: instead of `MethodCreator`, "
"the `Consumer` accepts `*Generation` which provides access to the "
"`BlockCreator` and the necessary variables."
msgstr ""
"其他应用程序接口也有同样的变化： `Consumer` 不再接受 `MethodCreator` ，而是接受 `*Generation` ，后者提供对 "
"`BlockCreator` 和必要变量的访问。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"One might ask: why does the new API provide access to a `BlockCreator` and "
"not to a `MethodCreator`, which clearly still exists in Gizmo 2?\n"
"And it would be a good question.\n"
"The answer, as it turns out, is efficiency.\n"
"The previous API that did provide access to a `MethodCreator` required "
"generating a whole new method that would only host the user-generated code.\n"
"The new API that _doesn't_ provide access to a `MethodCreator` allows "
"embedding the user-generated code into a method that contains other, ArC-"
"generated code.\n"
"Thus, the number of methods in the generated classes is smaller and the "
"generated code is more compact."
msgstr ""
"有人可能会问：为什么新的应用程序接口提供对 `BlockCreator` 的访问，而不是对 `MethodCreator` 的访问，而 在 Gizmo "
"2 中显然仍然存在？这个问题问得好。答案就是效率。以前的 API 确实提供了对 `MethodCreator` "
"的访问权限，但这需要生成一个全新的方法，而这个方法只能承载用户生成的代码。新的 API _不_ 提供访问 `MethodCreator` "
"的权限，允许将用户生成的代码嵌入到包含其他 ArC 生成代码的方法中。因此，生成类中的方法数量更少，生成的代码也更紧凑。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "Conclusion"
msgstr "解决方案"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"Gizmo 2 is an evolution (some might say _revolution_) of Gizmo 1, the "
"simplified bytecode generation library used by all of Quarkus.\n"
"ArC is a heavy user of Gizmo and it just recently migrated to Gizmo 2.\n"
"There are some breaking changes that might affect Quarkus extensions (not "
"applications)."
msgstr ""
"Gizmo 2 是 Gizmo 1 的进化版（也有人说是 _革命_ 版），Gizmo 1 是 Quarkus 使用的简化字节码生成库。ArC 是 "
"Gizmo 的忠实用户，最近刚刚迁移到 Gizmo 2。Gizmo 2 有一些突破性的变化，可能会影响 Quarkus 扩展（而非应用程序）。"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid ""
"In this post, we reviewed the API breakages and showed a simple migration "
"scenario.\n"
"Hopefully, your extensions are not affected, because they use the higher-"
"level APIs, but if they are, you'll need to migrate as well.\n"
"Then, your extension will only be compatible with Quarkus 3.30 and above; it "
"will stop working with previous versions.\n"
"Plan accordingly."
msgstr ""
"在这篇文章中，我们回顾了 API 的中断情况，并展示了一个简单的迁移方案。希望你的扩展不会受到影响，因为它们使用的是更高级别的 "
"API，但如果它们受到影响，你也需要进行迁移。然后，你的扩展将只与 Quarkus 3.30 "
"及以上版本兼容；它将停止与以前版本的兼容。请做好相应的计划。"
