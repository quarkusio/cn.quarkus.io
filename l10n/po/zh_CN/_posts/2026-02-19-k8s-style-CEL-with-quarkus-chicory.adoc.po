msgid ""
msgstr ""
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Generator: jekyll-l10n\n"

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "A Go CEL Policy Engine in Java, with Quarkus Chicory"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Quarkus Chicory brings the power of the Chicory WebAssembly runtime to Quarkus applications. Here we will see how the popular Go-based Google CEL library is integrated to implement a Kubernetes style CEL validator."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"A few days ago, we released the https://github.com/quarkiverse/quarkus-chicory/releases/tag/0.0.1[first version\n"
"of Quarkus Chicory], an extension that brings the power of the\n"
"https://github.com/dylibso/chicory[Chicory WebAssembly runtime] to Quarkus applications."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "While iterating on development, we felt the need to implement an integration test based on a real world use case."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "After some research and experiments on popular scenarios we finally landed on a tasty one :-)"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "A Kubernetes-style CEL Policy Engine"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"CEL allows expression based policy validation of Kubernetes resources, and this requirement is implemented by\n"
"operators... which are _generally_ written in Go :-)"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"But Quarkus Java based operators exist too - like the Keycloak operator - so what?\n"
"Are we forced to implement a CEL policy validation engine in Java, from scratch?\n"
"Or should we find a suitable Java library, for example https://github.com/projectnessie/cel-java?"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "None of the above: this is where Chicory, a WebAssembly runtime for Java, comes to help."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Let's just re-use a broadly used and well tested Go library, calling exported functions from Java, in a sandboxed,\n"
"secure way, and be happy with it!"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Why?"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "no rewrites"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "low maintenance"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "1:1 behavior"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "A Chicory extension for Quarkus applications"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Chicory is an open-source, 100% native Java WebAssembly (Wasm) runtime."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Its primary goal is to allow Java developers to run Wasm modules within the JVM,\n"
"without relying on native libraries, JNI (Java Native Interface) usage, or unsafe code."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Unlike other Wasm runtimes that require platform-specific binaries, Chicory is pure Java."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"It executes Wasm code within the JVM's memory space, providing a \"double sandbox\" effect (Wasm isolation + JVM\n"
"security).\n"
"It also provides WASI (WebAssembly System Interface) support, that allows Wasm modules to interact with system\n"
"resources safely.\n"
"Finally, it includes both an _interpreter_ and a _runtime compiler_ for quick execution, in addition to a _build-time\n"
"compiler_ that converts Wasm into Java bytecode for optimal performance, see\n"
"https://chicory.dev/docs/usage/execution_modes/[Chicory execution modes]."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"It is ideal for plugin systems, allowing users to write safe plugins in any language (Rust, C++, Go, etc.) that compiles\n"
"to Wasm, and running them inside a Java app.\n"
"It can be used for Serverless/Edge Computing cases, as it provides a mean to run lightweight logic on Java-based\n"
"infrastructure without the overhead of application containers."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"And for something that never gets old, i.e. cross-platform portability, your application remains _\"Write Once, Run\n"
"Anywhere\"_, without managing different `.so` or `.dll` files for different architectures."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"You can learn more about https://chicory.dev/docs/[Chicory], but from now on let's focus on its Quarkus\n"
"extension, here. :-)"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"_Quarkus Chicory brings Chicory to Quarkus application developers, integrating its features into the\n"
"Quarkus ecosystem and applications build-time and runtime peculiarities, for a natural developer experience.\n"
"It just... works!_"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Features"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Build-Time Code Generation"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Generates Java bytecode from WebAssembly modules, thus replacing the Chicory Maven plugin."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Dependency Management"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Automatically handles version alignment between Quarkus and Chicoryâ€™s ASM dependencies."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Multi WASM Module Support"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Configure and manage multiple WebAssembly modules."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Dynamic Loading"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Manage runtime-loaded WASM modules."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Intelligent Execution Mode Selection"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Configures the `MachineFactory` and `WasmModule` instances based on the environment.\n"
"`MachineFactory` can leverage build-time generated bytecode for optimal performance in production/native,\n"
"and use runtime or interpreter mode during development or test.\n"
"Similarly, `WasmModule` instances can be initialized with WASM metadata rather than pure WASM payload,\n"
"again for better performance and memory footprint, by leveraging the build-time code generation process."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Live Reload in Development"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Static modules are automatically watched and reloaded. Think of everyone's favorite `quarkus:dev`, but with Rust and\n"
"Go modules"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Native Image Compatibility"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "WASM/WASI support"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"With such potential in our hands, we chose the popular https://github.com/google/cel-go[Google CEL], a Go library/API\n"
"adopted by several Go operators, and decided to integrate it in our application."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Application setup and configuration"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Creating the application is straightforward using the Quarkus Maven plugin.\n"
"Note that Quarkus 3.x requires Java 17 or higher (we used Java 21 for this example):"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Next, we add the Quarkus Chicory extension to our pom.xml:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Finally, the WASM module configuration goes in application.properties:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"This tells Quarkus Chicory to generate a `GoCelModule` class at build time from the specified WASM file.\n"
"The extension will automatically generate Java bytecode from the WebAssembly module, configure the appropriate\n"
"`MachineFactory` based on the runtime environment, and  - in development mode - watch the WASM file for changes to\n"
"trigger live reload."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"One last step, now. We will use the\n"
"https://chicory.dev/docs/usage/annotations#wasmmoduleinterface[`WasmModuleInterface` annotation] and configure the\n"
"https://chicory.dev/docs/usage/annotations#enabling-the-annotation-processor[annotation processor],\n"
"for Chicory to generate a Java class containing methods mapping 1:1 to Go exported functions."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "First, let's create a `K8sCel` Java class where to place our annotation:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"At build-time, the Chicory annotation processor will discover such annotation and generate a `K8sCel_ModuleExports`\n"
"class, which provides the exported methods:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "And that's enough!"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "The `WasmQuarkusContext` API"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "The example application follows a clean architecture pattern with separated concerns:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "**K8sCelValidatorService** - Manages WASM integration and business logic"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "**K8sCelValidatorResource** - Provides REST API endpoint"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"The Quarkus Chicory extension provides the `WasmQuarkusContext` API for injection, to access configured WASM modules.\n"
"Here's how we use it in our service:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"The injected `WasmQuarkusContext` bean configures `Instance.Builder` to use `MachineFactory` and `WasmModule`\n"
"instances, which are created dynamically, based on the application configuration and execution environment."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Once `instance` is built, `export` is initialized with a `K8sCel_ModuleExports` instance, providing exported functions\n"
"which are called later in the `validate()` method."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"The exported \"_start\" function is called, to initialize the Go runtime. This executes the Go program `main()`\n"
"function. As it's empty in our implementation, it will exit immediately, so we catch `WasiExitExcpetion` to check for\n"
"a 0 (no errors) exit code."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "A note about multi-user and thread safety"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"`WasmQuarkusContext` instances are injected as `@ApplicationScoped` beans. This means that a unique application instance\n"
"can be used by several clients (or user requests) and threads.\n"
"That being said, the API implementation is _stateless_, i.e. `getMachineFactory()` and `getWasmModule()` always return\n"
"new instances."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"The way such instances are dealt with, and how their lifecycle is orchestrated, is something that pertains to the\n"
"application domain. For example, the above implementation doesn't take concurrency into account. If multiple\n"
"threads are going to consume the same `Memory` instance, a thread-safe implementation would be required in order to\n"
"avoid corrupting the shared `WasmModule` linear memory."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Back to our application code, the REST resource is then a simple delegation layer:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "The `WasmQuarkusContext` API provides two key methods:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "`getWasmModule()`: returns the parsed WebAssembly module"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"`getMachineFactory()`: returns the appropriate `MachineFactory` based on environment\n"
"(interpreter for dev, build-time compilation for production/native)"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"The `@Named` qualifier matches the module name from application.properties.\n"
"The extension handles all the complexity of WASM module lifecycle, allowing us to focus on the business logic."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "How it works: Go -> Wasm -> Java bytecode"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"The heart of our application is the Go CEL implementation, compiled to WebAssembly.\n"
"The Go code implements three key exported functions:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "This Go code is compiled to WASM using the WASI target:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "In our service implementation:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Java allocates WASM memory for the policy string and input resource manifest (JSON), and writes the data to WASM\n"
"memory"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Java calls `evalPolicy()` with pointers to arguments and their size"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Go code reads from its memory space, and evaluates the CEL expression using the Google CEL library"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Go returns an integer result code (1=allow, 0=deny, negative=error)"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Java interprets the result and performs clean up"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"_This demonstrates the power of WebAssembly: we can use the mature, battle-tested Google CEL-Go library\n"
"from Java without reimplementing CEL from scratch._"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "The WASM boundary provides a clean and safe interface between the two languages."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "In production, we can write CEL policies that validate Kubernetes resources just like Go operators do:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Conclusion"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"By combining Quarkus Chicory with Google CEL-Go compiled to WebAssembly, we've created a\n"
"Kubernetes-style CEL policy engine that runs entirely in Java."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "This approach offers several benefits:"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Reuse existing Go libraries: No need to reimplement CEL in Java, 1:1 mapping with original Go code"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Type safety and performance: Quarkus Chicory generates Java bytecode from WASM modules"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Production ready: The same CEL library used by Go operators, now available in Java"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "Developer experience: Live reload, build-time code generation, and native image support"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"Ecosystem compatibility: Works seamlessly with\n"
"https://github.com/operator-framework/java-operator-sdk[Java-based Kubernetes operators]"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"This demonstrates that WebAssembly is not just a browser technology,\n"
"but rather a powerful tool for cross-language interoperability in cloud-native applications, and\n"
"showcases how to integrate this workflow easily in Quarkus applications, thanks to Quarkus Chicory."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid ""
"For Java developers building Kubernetes operators, this approach opens up a large part of the Go ecosystem\n"
"without leaving the JVM."
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "You can find the complete working example at: https://github.com/fabiobrz/quarkus-cel-k8s-validator"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "References"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "https://docs.quarkiverse.io/quarkus-chicory/dev[Quarkus Chicory Extension]"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "https://github.com/dylibso/chicory[Chicory WebAssembly Runtime]"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "https://github.com/google/cel-go[Google CEL]"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "https://kubernetes.io/docs/reference/using-api/cel/[Kubernetes CEL Validation]"
msgstr ""

#: _posts/2026-02-19-k8s-style-CEL-with-quarkus-chicory.adoc
msgid "https://wasi.dev/[WebAssembly System Interface (WASI)]"
msgstr ""
