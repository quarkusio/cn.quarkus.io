# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"POT-Creation-Date: 2022-05-12 15:52+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. type: YAML Front Matter: title
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy, no-wrap
msgid "Kafka - How to fail gracefully"
msgstr "Kafka - 如何优雅地失败"

#. type: YAML Front Matter: synopsis
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy, no-wrap
msgid "Failure handling in the Kafka connector"
msgstr "Kafka连接器中的故障处理"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"Failures are inevitable.\n"
"There is nothing we can do about that, and that also applies to Kafka applications.\n"
"Your application may contain a faulty component misbehaving once in a while, or unable to process a specific Kafka record.\n"
"In this post, we are going to see how we can manage these failures."
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "Ack and Nack"
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"But, first, we need to explain how it works under the hood.\n"
"When using reactive messaging, your application receives https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/2.4/concepts.html#messages[Messages].\n"
"Even if your method handles _payloads_, there are Messages under the hood, and it unwraps the payload just before calling your method."
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/messages.png[]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/messages.png[alt=\"messages\"]"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"A message can be _acked_ or _nacked_.\n"
"If the message processing completes successfully, the message is acknowledged.\n"
"You can manually trigger the acknowledgment (by calling the `ack()` method) or let the framework handle it automatically.\n"
"In general, it's the outbound connector that acknowledges the message once the outgoing message has been sent to the broker successfully.\n"
"If not configured otherwise, acknowledging a message acknowledges the _source_ message, acknowledging its source, until we reach the root message, most probably created by an inbound connector:"
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/ack-chain.png[Acknowledgement chain]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/ack-chain.png[alt=\"Acknowledgement chain\"]"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"When the inbound connector receives the acknowledgment, it can act upon it and, for example, indicate to the broker that the message processing succeeded.\n"
"In the context of Kafka, there are various commit strategies.\n"
"We will cover these in a future post."
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"But as said earlier, failures are inevitable.\n"
"For example, you may have a misbehaving component throwing exceptions, or the outbound connector cannot send the messages because the remote broker is unavailable.\n"
"In these cases, the message is _nacked_, indicating that the processing failed.\n"
"Similarly to successful acknowledgment, negative acknowledgment can be triggered manually (using the `nack` method) or handled automatically.\n"
"For example, if your method throws an exception, the message is nacked.\n"
"As with _ack_, nacking a message nacks its source, and the nack is propagated until the inbound connector:"
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/nack-chain.png[Negative acknowledgment chain]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/nack-chain.png[alt=\"Negative acknowledgment chain\"]"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"It's the responsibility of the connector to decide how to react in this case.\n"
"The Kafka connector proposes three failure handling strategies, and that's what we are going to detail now."
msgstr ""

#. type: Title ==
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy, no-wrap
msgid "The \"Fail-Fast\" strategy"
msgstr "快速失败 \"战略"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"The first strategy is the simplest, but not sure we can qualify it with \"smoothly.\"\n"
"It's the default strategy.\n"
"As soon as a message is nacked, the connector reports the failure, and the application stops.\n"
"If you use the health checks extension, the application is marked as unhealthy, and your orchestrator may restart the application."
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/fail-fast.png[Fail-Fast]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/fail-fast.png[alt=\"Fail-Fast\"]"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"But, it's time to demonstrate it.\n"
"I've created a simple application receiving movie titles from Kafka and failing (with an exception) if the title contains a `'` or `,`.\n"
"You can check the code on this https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkafailfast-java[Gist], or run it using:"
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"Starting the application starts a Kafka broker using Docker.\n"
"The first start may require downloading the appropriate container image."
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "If you ran the application and check the log, you will see:"
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "Now, if you open your browser to http://localhost:8080/health, you will see that the failure has been caught and the application is unhealthy:"
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"This approach works well with sporadic, network-related issues.\n"
"Still, if the source of the failure is your application code, you may enter a restart loop.\n"
"Indeed, when the application restarts, it may again receive the message (the red one from the previous picture) that would produce the same failure again and again."
msgstr ""

#. type: Title ==
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy, no-wrap
msgid "The \"Ignore\" strategy"
msgstr "忽略 \"策略"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"The second strategy is also straightforward: just close your eyes.\n"
"When a message is nacked, it ignores the failure and continues the processing:"
msgstr ""

#. type: delimited block -
#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "image:/assets/images/posts/kafka-failure-strategy/ignore.png[Ignore strategy]"
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"The log indicates the failure, but it continues the processing with the next one.\n"
"You can only use this strategy if you don't need to manage all the messages or if your application is handling the failure internally."
msgstr ""

#. type: delimited block -
#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "To enable this strategy, configure the channel with:"
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "You can try this strategy with https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkaignorefailure-java[Gist], or run it using:"
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "If you ran the application and check the log, you will see two exceptions:"
msgstr "如果你运行该应用程序并检查日志，你会看到两个异常情况。"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"Look at the last line.\n"
"As explained, it continues the processing with the next message."
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "If you check the health of the application (using http://localhost:8080/health), everything is fine:"
msgstr "如果你检查应用程序的健康状况（使用 http://localhost:8080/health ，一切正常。"

#. type: Title ==
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy, no-wrap
msgid "The \"Dead-Letter Topic\" strategy"
msgstr "死板的主题 \"策略"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"The https://en.wikipedia.org/wiki/Dead_letter_queue[dead-letter queue] is a well-known pattern to handle message processing failure.\n"
"Instead of failing fast or ignoring and continuing the processing, it stores the failing messages into a specific destination: a dead letter.\n"
"An administrator, human or software, can review the failing messages and decide what can be done (retry, skip, etc.).\n"
"Note that you can only apply this strategy if the ordering is not essential to the application."
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "You can, later, review the failing messages:"
msgstr "你可以在以后审查失败的信息。"

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/dead-letter-topic.png[Dead-letter topic]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/dead-letter-topic.png[alt=\"Dead-letter topic\"]"

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "To enable this strategy, you need to add the following attribute to your configuration:"
msgstr "要启用这一策略，你需要在你的配置中添加以下属性。"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"By default, it writes to the `dead-letter-topic-$topic-name` topic.\n"
"In our demo, it's `dead-letter-topic-movies`.\n"
"But you can also configure the topic by setting the `dead-letter-queue.topic` attribute."
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "Depending on your Kafka configuration, you may have to create the topic beforehand and configure the replication factor."
msgstr "根据你的Kafka配置，你可能需要事先创建主题并配置复制因子。"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"Let's try it!\n"
"The https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkadeadlettertopic-java[KafkaDeadLetterTopic.java] file extends our previous application.\n"
"It uses the dead-letter-topic failure strategy and contains a component reading the dead-letter topic (`dead-letter-topic-movies`)."
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "You can run the application using:"
msgstr "你可以用以下方式运行该应用程序。"

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"If you check the log, you will see the two expected exceptions and that all the titles are processed.\n"
"You will also notice:"
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "This log is written by the component reading the dead-letter topic:"
msgstr "这个日志是由读取死信主题的组件写的。"

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "When reading messages from the dead-letter topic, you can retrieve the failure reason by reading the `dead-letter-reason` header."
msgstr "当从死信主题中读取消息时，你可以通过读取 `dead-letter-reason` header来检索失败原因。"

#. type: Title ==
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy, no-wrap
msgid "Conclusion"
msgstr "总结"

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "The Kafka connector proposes three strategies to handle failures."
msgstr "Kafka连接器提出了三种策略来处理故障。"

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
#, fuzzy
msgid "`fail-fast` (default) stops the application and marks it unhealthy"
msgstr " `fail-fast` (默认情况下）停止应用程序并将其标记为不健康状态。"

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "`ignore` continues the processing even if there are failures."
msgstr ""

#. type: Plain text
#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid "`dead-letter-queue` sends failing messages to another Kafka topic for further investigation."
msgstr ""

#: _posts/2020-10-20-kafka-failure-strategy.adoc
msgid ""
"Next time, we will talk about the commit strategies because failures are inevitable, but successful processing happens sometimes!\n"
"Stay tuned!"
msgstr ""
