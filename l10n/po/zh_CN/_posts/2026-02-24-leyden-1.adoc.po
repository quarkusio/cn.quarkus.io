msgid ""
msgstr ""
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Generator: jekyll-l10n\n"

#: _posts/2026-02-24-leyden-1.adoc
msgid "How Project Leyden brought a new perspective"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "This is a story about Project Leyden. And this is not a story about Project Leyden. It is a story about how Project Leyden gave us a new perspective on how we think about startup performance in Quarkus."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"This is a story about Project Leyden.\n"
"And this is not a story about Project Leyden."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "It is a story about how Project Leyden gave us a new perspective on how we think about startup performance in Quarkus, and, more broadly, in Java."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "It is a story with flamegraphs."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Isn't it the best kind of story?"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Acknowledgments"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"I shared this journey with my dear colleague Georgios Andrianakis, who was also instrumental in making this happen.\n"
"And this is exactly the kind of journey you want to share with someone."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "How the story started"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"It all started with me complaining, more than once, that improving startup performance in Quarkus had become really hard.\n"
"Startup was cluttered with class loading noise.\n"
"Which means that every time you looked at a startup profile, you clicked on something suspicious and realized:"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Oh well, that's just us loading a class for the first time... bummer."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"I'm a patient person.\n"
"But you only get so many mouse clicks per day."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Then, one day, I took a shower, and I had this idea:"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Isn't Project Leyden supposed to improve the class loading story, among other things?"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Maybe we could use it to get rid of the class loading noise and get a clearer picture of what's really going on during startup?"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"As it turns out, this was a bit of a rabbit hole.\n"
"Project Leyden delivered results that were far better than expected, and we ended up working with Georgios on integrating it tightly in Quarkus\n"
"(you can see another blog post coming, right?)."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"But today, I promised you flamegraphs. I know you're all excited about them.\n"
"Let's get to it!"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Changing the perspective"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "We'll explore this in more detail in a future blog post, but for now, suffice it to say that Project Leyden caches classes in a loaded and linked state, along with additional metadata such as method profiling information and, soon, compiled code."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"In practice, Project Leyden improves Java startup performance by shifting expensive work, like class loading and linking, into a dedicated training phase.\n"
"By capturing that state ahead of time, the application can skip much of the redundant setup normally performed at runtime."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "In other words, if everything is recorded properly, class loading can be almost entirely taken out of the startup path."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "And suddenly, you're in brand-new territory: the Quarkus REST application you get from a simple `quarkus create app` starts in 130 milliseconds."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "That's already pretty good, right? But what's even more interesting is that we were able to do much better (see you in the next blog post, remember?)."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"And this is where the perspective shifts significantly: when you start in ~ 100 milliseconds, every dozen milliseconds you save becomes a meaningful improvement.\n"
"You can no longer afford to ignore a 5-millisecond cost."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "I can hear someone in the room shouting:"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Stop with the words! I want my flamegraphs!"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Fine, fine."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "How can we improve as an ecosystem?"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"One extremely important note before we begin: **we're not trying to criticize any library or framework here**.\n"
"We also found some low-hanging fruits in Quarkus itself, **we're all in the same boat here**."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"The goal of this blog post is to show how Project Leyden helped us uncover things that had been hidden for far too long.\n"
"And hopefully, this will give other library and framework authors a few useful ideas, and ultimately help improve the Java ecosystem as a whole."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "And in the worst case, at least you got your flamegraphs \\o/."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Compatibility layers"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Netty trying to determine whether virtual threads are available"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Many libraries include compatibility layers to support multiple JDK versions.\n"
"Typically, they rely on reflection to determine whether features like virtual threads are available."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"In the Quarkus ecosystem, this is common in low-level libraries such as Netty or Vert.x.\n"
"But in reality, we see this pattern everywhere."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "We should avoid this. It has a cost, and that cost is paid at **every single** startup of every application using these libraries."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Multi-release JARs are not perfect.\n"
"They're harder to maintain, harder to test, and not always well supported by IDEs.\n"
"But they do solve this problem.\n"
"And I would argue that, as library and framework authors, it's our responsibility to ensure the cost is paid once at build time, not at every application startup."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Together with Georgios, we decided to experiment with rewriting the bytecode of some of these libraries at build time to remove the reflective calls and replace them with direct invocations,\n"
"when the application was targeting a Java version that supports the feature."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "It's a bit of a hack, and definitely not something we want to maintain long term, but it was a great way to validate the idea and score a few quick wins."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Reading annotations"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "This one isn't new to us: one of the reasons we wrote Quarkus in the first place was to avoid reading annotations at runtime."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"For most of our use cases, we can process annotations at build time and generate the necessary bytecode so there's no need to inspect them at runtime.\n"
"Jandex, our annotation indexer, is a fantastic tool for this, and we use it extensively in Quarkus.\n"
"But... there are still cases where annotations are read at runtime, even in Quarkus."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Why is reading annotations so costly?\n"
"Because parsing them has a cost. It happens the first time you try to access them at runtime, and the JDK then creates proxy instances to expose the annotation values."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Netty and marker annotations"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Netty trying to determine if a `ChannelHandler` is sharable"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "The Netty case is particularly interesting because it reads annotations to determine the capabilities of interface implementations."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "For this kind of use case, we recommend using marker interfaces or methods instead of annotations."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Georgios once again resorted to bytecode rewriting to eliminate the annotation lookup.\n"
"Again, this isn't something we want to maintain in the long term."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Hibernate ORM"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Hibernate ORM is also extremely interesting in this context."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"The first important point is that, with Hibernate ORM, in Quarkus, we still build the metadata at runtime.\n"
"That means we end up reading a lot of annotations at runtime.\n"
"A long-term effort has already started to improve this situation,\n"
"but it's a significant undertaking and will take time before we can move metadata building to build time instead."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Let's set that aside for now."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"What's also interesting is that Hibernate ORM collects metadata about its own annotations at runtime, both Hibernate-specific annotations and JPA annotations.\n"
"And that's a lot of annotations, and a lot of metadata to process."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Hibernate ORM collecting metadata about its own annotations"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "For example, for each JPA or Hibernate annotation, it determines the annotation target (class, method, field), or whether it is inherited."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "In the end, this results in a substantial amount of annotation processing for something that changes very rarely."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"I identified this issue some time ago, and our colleague Luca Molteni from the Hibernate team will be looking into it soon.\n"
"We're not yet sure how easy it will be to fix, but you get the idea.\n"
"Whenever possible, this kind of metadata should be resolved once and for all.\n"
"And you should be able to enforce its correctness with tests to ensure it remains accurate and up to date."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Hopefully, we'll be able to improve this soon.\n"
"And the nice part is that any improvement here will benefit all applications using Hibernate ORM, not just Quarkus applications."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "The new cost of loading"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"When not using Leyden, you load a gazillion classes.\n"
"JAR files are opened anyway, that's _\"fine\"_.\n"
"Well, depending on your definition of _\"fine\"_."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "When using Leyden, you can reach a point where no classes are loaded at startup at all."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Which means that anything attempting to load something from the classpath will trigger JAR files to be opened (the first time they are accessed), and then read from disk."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "And you can be sure that some resources will be loaded from your classpath:"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "`ServiceLoader` service files (the ones in `META-INF/services/`), used by the JDK and many libraries and frameworks to discover interface implementations;"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Configuration files;"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "And probably many other things."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Non-existing classes and resources"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Why would you try to load a non-existing class?\n"
"That's a good question."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Hibernate ORM trying to load non-existing `package-info`"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Remember `package-info.java` files?\n"
"Hibernate ORM, for instance, tries to load them to inspect package-level annotations.\n"
"In a lot of cases, these files don't exist, and that's perfectly normal."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Caching class loading is within the scope of Leyden, but Leyden does not cache negative lookups.\n"
"Why? Because Leyden, while AOT, is still true Java.\n"
"Java is a dynamic language:\n"
"even if a class wasn't present when you recorded the cache, it might be added later.\n"
"Now, in practice, that's often not the case, especially in Quarkus, where we assume a closed world, but Leyden cannot rely on that assumption."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"In Quarkus, when using Leyden, we decided to generate empty `package-info` classes for all packages containing entities that don't already have one.\n"
"This way, Hibernate ORM doesn't have to attempt to load non-existing classes."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "JBoss Logging loading a non-existing class"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Another example is JBoss Logging internationalization: it attempts to load a class for the current locale, and if that class doesn't exist, it falls back to the default class."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"You see similar patterns with resources.\n"
"An application might try to load a configuration file or a service descriptor that doesn't exist. That's perfectly normal, the only way to know it's missing is to try."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"In Quarkus, we have a few class loader tricks to mitigate this.\n"
"But in the general case, you have to deal with it."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"And here's the catch: for all these cases, the runtime will walk the entire classpath (remember, it won't find anything), trying to locate the class or resource.\n"
"In doing so, it may open a large number of JAR files and read from them, just to conclude that the class or resource doesn't exist."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Granted, it doesn't read the entire JAR, each archive has an index, but still."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "ServiceLoader"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "A `ServiceLoader` storm"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Let's look at the `ServiceLoader` case in more detail, it's particularly interesting."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Once class loading is out of the picture, it becomes clear that a significant portion of startup time is spent loading service descriptors from JAR files.\n"
"We managed to improve this for some services using a class loader trick, but that only works for services loaded through the thread context class loader.\n"
"We don't yet have a good solution for services loaded by the JDK class loaders.\n"
"At least not for now."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"We'll go into more detail in the next blog post, where we'll talk more about Project Leyden itself and how we integrated it into Quarkus.\n"
"Stay tuned."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Some other _fun_ facts"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "UUID generation"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Generating a UUID for the first time"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"This one is easy: whenever you generate a `UUID`, the JDK will initialize a `SecureRandom` instance.\n"
"And initializing a `SecureRandom` instance doesn't come for free, oh no."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Sure, if your application ends up needing a `SecureRandom` anyway, you don't care.\n"
"But if it doesn't, having your favorite framework generate ``UUID``s for internal use is not ideal."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Obviously, if your application genuinely needs `UUID` generation, go ahead and use it."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "BigDecimal"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Initialization of `BigDecimal`"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"In the same vein, the `BigDecimal` class has a static initializer that actually performs a fair amount of work.\n"
"Initializing `BigDecimal` can take a noticeable amount of time."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "We stumbled upon this because we were using `BigDecimal` to perform some calculations when printing the Quarkus startup time."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "D'oh."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"We replaced that code, only to discover another issue:\n"
"`BigDecimal` was also being eagerly initialized in Hibernate ORM for a very narrow use case in the `DurationJavaType` class.\n"
"That has since been fixed as well."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Just like with ``UUID``s, if your application genuinely needs `BigDecimal`, you should use it and pay the cost."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "This is about avoiding the cost when you don't actually need it."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Time zones"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Loading the time zone database"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"We all know time zones are hard.\n"
"But now we also know that loading them is slow."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "The time zone database is quite large, and loading it, for example when calling `TimeZone.getDefault()`, can take a noticeable amount of time."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"Who would need a time zone in a server application, right?\n"
"For instance, your logging layer, which wants to print timestamps in the local time zone."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Loading the zone rules"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "And what's also interesting is that there's an additional cost for transforming the time zone to a `ZoneId`, as you also have to load the zone rules."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"These two issues still exist and I have no idea if we can even solve them,\n"
"but we were able to mitigate their cost somewhat in Quarkus when using the specific packaging we developed for AOT."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Conclusion"
msgstr "解决方案"

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"This post is about the work we did in Quarkus and the libraries Quarkus relies on.\n"
"But I would argue that the lessons we learned are applicable across the entire Java ecosystem."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "I hope that by sharing our experience, we can inspire other projects, especially library and framework authors, to take a similar approach and improve their startup performance."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"And to be honest, this isn't just about improving startup performance, it's also about reducing the resources wasted during startup.\n"
"We often talk about Green IT; let's make our libraries and frameworks greener, especially in cases where it's simple to achieve."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid ""
"We've shared some of our findings and recipes, but I'm sure there are others that are specific to each library and framework.\n"
"Now is a great time to look at your own startup profiles and see if you can spot some low-hanging fruit to boost performance.\n"
"And with Quarkus 3.32 and our new AOT integration coming soon, this is going to be easier than ever."
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "If you have questions, you know https://quarkusio.zulipchat.com/#narrow/channel/187038-dev[where to find us], and if you find something interesting, please share it with us, we'd love to hear about it!"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Onwards!"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "Come Join Us"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "We value your feedback a lot so please report bugs, ask for improvements... Let's build something great together!"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "If you are a Quarkus user or just curious, don't be shy and join our welcoming community:"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "provide feedback on https://github.com/quarkusio/quarkus/issues[GitHub];"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "craft some code and https://github.com/quarkusio/quarkus/pulls[push a PR];"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "discuss with us on https://quarkusio.zulipchat.com/[Zulip] and on the https://groups.google.com/d/forum/quarkus-dev[mailing list];"
msgstr ""

#: _posts/2026-02-24-leyden-1.adoc
msgid "ask your questions on https://stackoverflow.com/questions/tagged/quarkus[Stack Overflow]."
msgstr ""
